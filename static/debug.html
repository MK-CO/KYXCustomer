<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Platform Debug Console</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #5c64f4;
            --primary-hover: #4c54e4;
            --primary-light: #e6f3ff;
            --primary-ultra-light: #f8fbff;
            --success-color: #10b981;
            --success-light: #d1fae5;
            --warning-color: #f59e0b;
            --warning-light: #fef3c7;
            --danger-color: #ef4444;
            --danger-light: #fef2f2;
            --bg-primary: #e6f3ff;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --bg-hover: #f8fbff;
            --text-primary: #1a1a1a;
            --text-secondary: #666;
            --text-muted: #8892a6;
            --border-color: #e1e5e9;
            --border-hover: #d1d5db;
            --border-focus: #5c64f4;
            --shadow-sm: 0 2px 8px rgba(92, 100, 244, 0.08);
            --shadow-md: 0 4px 16px rgba(92, 100, 244, 0.12);
            --shadow-lg: 0 8px 32px rgba(92, 100, 244, 0.15);
            --shadow-button: 0 2px 8px rgba(92, 100, 244, 0.2);
            --shadow-button-hover: 0 4px 16px rgba(92, 100, 244, 0.35);
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* È°∂ÈÉ®ÂØºËà™Ê†è */
        .header {
            background: white;
            padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 24px;
            box-shadow: var(--shadow-sm);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .brand-logo {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .brand-logo::before {
            content: '';
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            position: relative;
        }

        .brand-logo::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: var(--primary-color);
            border-radius: 50%;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 14px;
            margin: 0;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            transition: all 0.2s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .card-header {
            padding: 20px 24px 16px;
            border-bottom: 1px solid var(--border-color);
            background: #fafbfc;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 0;
        }

        .card-icon {
            width: 32px;
            height: 32px;
            background: var(--primary-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
        }

        .card-body {
            padding: 24px;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .input, .select, .textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            transition: all 0.2s ease;
            background: var(--bg-secondary);
        }

        .input:focus, .select:focus, .textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgb(99 102 241 / 0.1);
        }

        .button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 8px 14px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            margin-right: 6px;
            margin-bottom: 6px;
            outline: none;
            position: relative;
            overflow: hidden;
            white-space: nowrap;
            min-height: 32px;
            box-shadow: var(--shadow-button);
        }

        .button:last-child {
            margin-right: 0;
        }

        .button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.6s ease;
        }

        .button:hover::before {
            width: 300px;
            height: 300px;
        }

        .button-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, #4a52e8 100%);
            color: white;
            border: 1px solid transparent;
        }

        .button-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-button-hover);
            background: linear-gradient(135deg, var(--primary-hover) 0%, #3d45d6 100%);
        }

        .button-success {
            background: linear-gradient(135deg, var(--success-color) 0%, #059669 100%);
            color: white;
            border: 1px solid transparent;
        }

        .button-success:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.35);
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }

        .button-warning {
            background: linear-gradient(135deg, var(--warning-color) 0%, #d97706 100%);
            color: white;
            border: 1px solid transparent;
        }

        .button-warning:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(245, 158, 11, 0.35);
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
        }

        .button-danger {
            background: linear-gradient(135deg, var(--danger-color) 0%, #dc2626 100%);
            color: white;
            border: 1px solid transparent;
        }

        .button-danger:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(239, 68, 68, 0.35);
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        }

        .button-outline {
            background: white;
            color: var(--primary-color);
            border: 1px solid var(--border-color);
        }

        .button-outline:hover {
            background: var(--bg-hover);
            border-color: var(--primary-color);
            transform: translateY(-1px);
            box-shadow: var(--shadow-button);
        }

        .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .button:disabled::before {
            display: none;
        }

        /* üî• Êñ∞Â¢ûÔºöÂ∞èÂ∞∫ÂØ∏ÊåâÈíÆÊ†∑Âºè */
        .button-small {
            padding: 4px 8px;
            font-size: 11px;
            min-height: 24px;
            gap: 4px;
        }

        .button:active {
            transform: translateY(0) !important;
        }

        .result-container {
            grid-column: 1 / -1;
            margin-top: 1.5rem;
        }

        .result {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 0.875rem;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: var(--shadow-sm);
        }

        .result-loading {
            background: #f0f9ff;
            border-color: #0ea5e9;
            color: #0c4a6e;
        }

        .result-success {
            background: #f0fdf4;
            border-color: var(--success-color);
            color: #14532d;
        }

        .result-error {
            background: #fef2f2;
            border-color: var(--danger-color);
            color: #991b1b;
        }

        .result-info {
            background: #f8fafc;
            border-color: var(--text-muted);
            color: var(--text-primary);
        }

        .result-warning {
            background: #fffbeb;
            border-color: #f59e0b;
            color: #92400e;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-online {
            background: #dcfce7;
            color: #166534;
        }

        .status-offline {
            background: #fef2f2;
            color: #991b1b;
        }

        .hidden {
            display: none !important;
        }

        .loading-spinner {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-card {
            background: var(--bg-primary);
            padding: 1rem;
            border-radius: var(--radius-md);
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            line-height: 1;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .auth-card {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-color: #f59e0b;
        }

        .auth-card .card-header {
            background: rgba(245, 158, 11, 0.1);
            border-bottom-color: #f59e0b;
        }

        .toggle-fields {
            transition: all 0.3s ease;
        }

        .field-group {
            padding: 1rem;
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            margin-top: 1rem;
            border: 1px solid var(--border-color);
        }

        .field-group h4 {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="brand-logo"></div>
                    <div>
                        <h1>AIPlatform ÊéßÂà∂Âè∞</h1>
                        <p>Êô∫ËÉΩÂàÜÊûêÁ≥ªÁªüÁÆ°ÁêÜ‰∏≠ÂøÉ</p>
                    </div>
                </div>
                
                <!-- ËΩÆËØ¢Áä∂ÊÄÅÊåáÁ§∫Âô® -->
                <div id="pollingStatus" style="display: none; background: var(--primary-light); padding: 10px 16px; border-radius: 12px; border: 1px solid var(--primary-color); font-size: 13px; box-shadow: var(--shadow-sm);">
                    <span style="color: var(--success-color); font-size: 16px; animation: pulse 2s infinite;">‚óè</span>
                    <span style="color: var(--text-primary); font-weight: 500; margin-left: 8px;">Ê≠£Âú®ÁõëÊéß‰ªªÂä°ËøõÂ∫¶...</span>
                    <button onclick="stopAllPolling()" class="button button-outline" style="margin-left: 12px; padding: 4px 12px; font-size: 11px;">
                        ‚èπ ÂÅúÊ≠¢ÁõëÊéß
                    </button>
                </div>
                
                <style>
                    @keyframes pulse {
                        0%, 100% { opacity: 1; }
                        50% { opacity: 0.5; }
                    }
                </style>
            </div>
        </div>

        <!-- APIÈÖçÁΩÆÔºàÈöêËóè‰ΩÜ‰øùÁïôÂäüËÉΩÔºâ -->
        <div style="display: none;">
            <input type="password" id="apiKey" value="YWktcGxhdGZvcm0tc21hcnQtMjAyNC1lbmNyeXB0ZWQ=">
            <input type="text" id="baseUrl" value="http://localhost:8993">
            </div>

        <!-- Task Management Table -->
        <div class="result-container" id="taskTableContainer">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">‚öô</div>
                        ‰ªªÂä°ÁÆ°ÁêÜ‰∏éÊâßË°åËÆ∞ÂΩï
                        <div style="margin-left: auto; display: flex; gap: 8px;">
                            <button onclick="refreshTaskConfigs()" class="button button-primary">
                                Âà∑Êñ∞
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body" style="overflow-x: auto;">
                    <!-- ‰ªªÂä°ÈÖçÁΩÆË°®Ê†º -->
                    <div id="taskConfigView" style="overflow-x: auto;">
                        <table id="taskConfigTable" style="width: 100%; min-width: 1200px; border-collapse: collapse; font-size: 13px; table-layout: fixed;">
                            <colgroup>
                                <col style="width: 18%;">
                                <col style="width: 10%;">
                                <col style="width: 12%;">
                                <col style="width: 10%;">
                                <col style="width: 12%;">
                                <col style="width: 12%;">
                                <col style="width: 10%;">
                                <col style="width: 16%;">
                            </colgroup>
                            <thead>
                                <tr style="background: var(--primary-ultra-light); border-bottom: 2px solid var(--border-focus);">
                                    <th style="padding: 14px 10px; text-align: left; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">‰ªªÂä°ÂêçÁß∞</th>
                                    <th style="padding: 14px 10px; text-align: left; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Á±ªÂûã</th>
                                    <th style="padding: 14px 10px; text-align: center; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Áä∂ÊÄÅÊéßÂà∂</th>
                                    <th style="padding: 14px 10px; text-align: left; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Ë∞ÉÂ∫¶Èó¥Èöî</th>
                                    <th style="padding: 14px 10px; text-align: left; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">‰∏äÊ¨°ÊâßË°å</th>
                                    <th style="padding: 14px 10px; text-align: left; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">‰∏ãÊ¨°ÊâßË°å</th>
                                    <th style="padding: 14px 10px; text-align: center; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">ÊâßË°åÁªüËÆ°</th>
                                    <th style="padding: 14px 10px; text-align: center; font-weight: 600; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="taskConfigTableBody">
                                <tr>
                                    <td colspan="8" style="padding: 2rem; text-align: center; color: var(--text-secondary);">
                                        Âä†ËΩΩ‰ªªÂä°ÈÖçÁΩÆ‰∏≠...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>


                            </div>
                        </div>
                    </div>

        <!-- System Monitor Table -->
        <div class="result-container" id="systemMonitorContainer" style="margin-top: 2rem;">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">‚ö°</div>
                        Á≥ªÁªüÁõëÊéß
                        <div style="margin-left: auto; display: flex; gap: 8px; align-items: center;">
                            <!-- üöÄ APSchedulerÊÄªÂºÄÂÖ≥ÊéßÂà∂ -->
                            <div style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-md);">
                                <span style="font-size: 12px; color: var(--text-secondary);">APSchedulerÊÄªÂºÄÂÖ≥:</span>
                                <div id="masterSwitchStatus" style="font-size: 12px; font-weight: 600;">
                                    <span id="masterSwitchText">Âä†ËΩΩ‰∏≠...</span>
                                </div>
                                <button id="masterSwitchToggle" onclick="toggleMasterSwitch()" 
                                        class="button button-small" 
                                        style="padding: 4px 8px; font-size: 11px; min-width: 50px;"
                                        disabled>
                                    ÂàáÊç¢
                                </button>
                            </div>
                            <button onclick="refreshSystemMonitor()" class="button button-primary">
                                Âà∑Êñ∞
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body" style="overflow-x: auto;">
                    <div id="systemMonitorView" style="overflow-x: auto;">
                        <table id="systemMonitorTable" style="width: 100%; min-width: 1200px; border-collapse: collapse; font-size: 13px; table-layout: fixed;">
                            <colgroup>
                                <col style="width: 18%;">
                                <col style="width: 10%;">
                                <col style="width: 12%;">
                                <col style="width: 10%;">
                                <col style="width: 12%;">
                                <col style="width: 12%;">
                                <col style="width: 10%;">
                                <col style="width: 16%;">
                            </colgroup>
                            <thead>
                                <tr style="background: var(--primary-ultra-light); border-bottom: 2px solid var(--border-focus);">
                                    <th style="padding: 14px 10px; text-align: left; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">ÁªÑ‰ª∂ÂêçÁß∞</th>
                                    <th style="padding: 14px 10px; text-align: center; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Áä∂ÊÄÅ</th>
                                    <th style="padding: 14px 10px; text-align: center; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">ÂΩìÂâç</th>
                                    <th style="padding: 14px 10px; text-align: center; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">ÊúÄÂ§ß</th>
                                    <th style="padding: 14px 10px; text-align: center; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Á≠âÂæÖ</th>
                                    <th style="padding: 14px 10px; text-align: center; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Â∑≤ÂÆåÊàê</th>
                                    <th style="padding: 14px 10px; text-align: center; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Á±ªÂûã</th>
                                    <th style="padding: 14px 10px; text-align: left; font-weight: 600; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">ÊèèËø∞</th>
                                </tr>
                            </thead>
                            <tbody id="systemMonitorTableBody">
                                <tr>
                                    <td colspan="8" style="padding: 2rem; text-align: center; color: var(--text-secondary);">
                                        Âä†ËΩΩÁ≥ªÁªüÁõëÊéß‰ø°ÊÅØ‰∏≠...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Task Records Modal -->
        <div id="taskRecordsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(92, 100, 244, 0.1); backdrop-filter: blur(8px); z-index: 10000; overflow-y: auto;">
            <div style="background: white; margin: 30px auto; max-width: 95%; width: 1400px; border-radius: 16px; box-shadow: var(--shadow-lg); border: 1px solid var(--border-color);">
                <div style="padding: 24px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; background: var(--primary-ultra-light); border-radius: 16px 16px 0 0;">
                    <h3 id="taskRecordsModalTitle" style="margin: 0; color: var(--text-primary); font-size: 18px; font-weight: 600;">‰ªªÂä°ÊâßË°åËÆ∞ÂΩï</h3>
                    <button onclick="closeTaskRecordsModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-secondary); padding: 8px; border-radius: 50%; transition: all 0.2s ease;" onmouseover="this.style.background='var(--bg-hover)'" onmouseout="this.style.background='none'">√ó</button>
                </div>
                <div style="padding: 20px;">
                    <div style="margin-bottom: 16px; display: flex; gap: 12px; align-items: center;">
                        <button onclick="refreshTaskRecordsModal()" class="button button-primary">üîÑ Âà∑Êñ∞</button>
                        <span id="taskRecordsCount" style="color: var(--text-secondary); font-size: 14px; padding: 8px 12px; background: var(--primary-light); border-radius: 6px;"></span>
                    </div>
                    <div style="overflow-x: auto; max-height: 60vh; border: 1px solid var(--border-color); border-radius: 8px;">
                        <table id="taskRecordsModalTable" style="width: 100%; min-width: 1500px; border-collapse: collapse; font-size: 12px; table-layout: fixed;">
                            <colgroup>
                                <col style="width: 8%;">
                                <col style="width: 12%;">
                                <col style="width: 7%;">
                                <col style="width: 7%;">
                                <col style="width: 10%;">
                                <col style="width: 10%;">
                                <col style="width: 8%;">
                                <col style="width: 10%;">
                                <col style="width: 12%;">
                                <col style="width: 12%;">
                                <col style="width: 10%;">
                            </colgroup>
                            <thead>
                                <tr style="background: var(--primary-ultra-light); border-bottom: 2px solid var(--border-focus); position: sticky; top: 0;">
                                    <th style="padding: 12px 8px; text-align: left; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">‰ªªÂä°ID</th>
                                    <th style="padding: 12px 8px; text-align: left; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">‰ªªÂä°ÂêçÁß∞</th>
                                    <th style="padding: 12px 8px; text-align: left; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Áä∂ÊÄÅ</th>
                                    <th style="padding: 12px 8px; text-align: left; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Ëß¶ÂèëÊñπÂºè</th>
                                    <th style="padding: 12px 8px; text-align: left; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">ÂºÄÂßãÊó∂Èó¥</th>
                                    <th style="padding: 12px 8px; text-align: left; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">ÁªìÊùüÊó∂Èó¥</th>
                                    <th style="padding: 12px 8px; text-align: left; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">ËÄóÊó∂</th>
                                    <th style="padding: 12px 8px; text-align: center; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">ËøõÂ∫¶</th>
                                    <th style="padding: 12px 8px; text-align: center; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Â§ÑÁêÜËÆ∞ÂΩï</th>
                                    <th style="padding: 12px 8px; text-align: left; font-weight: 600; color: var(--text-primary); border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Ë∑≥ËøáÂéüÂõ†</th>
                                    <th style="padding: 12px 8px; text-align: center; font-weight: 600; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="taskRecordsModalBody">
                                <tr>
                                    <td colspan="11" style="padding: 2rem; text-align: center; color: var(--text-secondary);">
                                        Âä†ËΩΩ‰∏≠...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Result Display -->
        <div class="result-container">
            <div id="result" class="result result-info">
                ÂáÜÂ§áÂ∞±Áª™ÔºåÁ≠âÂæÖÊìç‰Ωú...
            </div>
        </div>
            </div>

        <!-- Êó•ÊúüÈÄâÊã©Ê®°ÊÄÅÊ°Ü -->
        <div id="dateSelectionModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(92, 100, 244, 0.1); backdrop-filter: blur(8px); z-index: 2000; align-items: center; justify-content: center;">
            <div style="background: white; border-radius: 16px; padding: 2rem; max-width: 450px; width: 90%; box-shadow: var(--shadow-lg); border: 1px solid var(--border-color);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color);">
                    <h3 style="margin: 0; color: var(--text-primary); font-size: 18px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                        <span style="color: var(--primary-color);">üìÖ</span>
                        ÈÄâÊã©ÊâßË°åÊó∂Èó¥ËåÉÂõ¥
                    </h3>
                    <button onclick="closeDateSelectionModal()" style="background: none; border: none; font-size: 20px; color: var(--text-secondary); cursor: pointer; padding: 8px; border-radius: 50%; transition: all 0.2s ease;" onmouseover="this.style.background='var(--bg-hover)'" onmouseout="this.style.background='none'">√ó</button>
                </div>
                
                <div style="margin-bottom: 2rem;">
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500; font-size: 14px;">
                            ÂºÄÂßãÊó•Êúü
                        </label>
                        <input type="date" id="taskStartDate" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: var(--radius-md); background: var(--bg-secondary); color: var(--text-primary); font-size: 14px; transition: all 0.2s ease;" onfocus="this.style.borderColor='var(--border-focus)'; this.style.boxShadow='0 0 0 3px rgba(92, 100, 244, 0.1)'" onblur="this.style.borderColor='var(--border-color)'; this.style.boxShadow='none'">
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500; font-size: 14px;">
                            ÁªìÊùüÊó•Êúü
                        </label>
                        <input type="date" id="taskEndDate" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: var(--radius-md); background: var(--bg-secondary); color: var(--text-primary); font-size: 14px; transition: all 0.2s ease;" onfocus="this.style.borderColor='var(--border-focus)'; this.style.boxShadow='0 0 0 3px rgba(92, 100, 244, 0.1)'" onblur="this.style.borderColor='var(--border-color)'; this.style.boxShadow='none'">
                    </div>
                    
                    <div style="padding: 12px; background: var(--primary-light); border-radius: var(--radius-md); border-left: 4px solid var(--primary-color);">
                        <div style="font-size: 13px; color: var(--text-secondary); line-height: 1.4;">
                            üí° <strong>ÊèêÁ§∫Ôºö</strong>ÈÄâÊã©Ë¶ÅÂ§ÑÁêÜÁöÑÊï∞ÊçÆÊó∂Èó¥ËåÉÂõ¥ÔºåÁ≥ªÁªüÂ∞ÜÊäΩÂèñËØ•Êó∂Èó¥ÊÆµÂÜÖÁöÑÊï∞ÊçÆÂπ∂ËøõË°åÂàÜÊûê
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button onclick="closeDateSelectionModal()" class="button button-outline" style="margin: 0;">
                        ÂèñÊ∂à
                    </button>
                    <button onclick="confirmTaskExecution()" class="button button-primary" style="margin: 0;">
                        üöÄ ÊâßË°å‰ªªÂä°
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ëé∑ÂèñAPIÈÖçÁΩÆ
        function getApiConfig() {
            return {
                baseUrl: document.getElementById('baseUrl').value.replace(/\/$/, ''),
                apiKey: document.getElementById('apiKey').value || 'YWktcGxhdGZvcm0tc21hcnQtMjAyNC1lbmNyeXB0ZWQ='
            };
        }

        // ÈÄöÁî®APIËØ∑Ê±ÇÂáΩÊï∞
        async function apiRequest(endpoint, method = 'GET', data = null) {
            const config = getApiConfig();
            const url = `${config.baseUrl}${endpoint}`;
            
            // ‰ºòÂÖà‰ΩøÁî®localStorage‰∏≠ÁöÑtokenÔºåÂê¶Âàô‰ΩøÁî®ÈÖçÁΩÆÁöÑAPI Key
            const token = localStorage.getItem('auth_token') || config.apiKey;
            
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                }
            };

            if (data && method !== 'GET') {
                options.body = JSON.stringify(data);
            }

            try {
                showLoading();
                const response = await fetch(url, options);
                
                if (response.status === 429) {
                    // ÈôêÊµÅÈîôËØØÁâπÊÆäÂ§ÑÁêÜ
                    try {
                        const errorResult = await response.json();
                        handleRateLimitError(errorResult);
                        return errorResult;
                    } catch (e) {
                        // Â¶ÇÊûúÊó†Ê≥ïËß£ÊûêJSONÔºå‰ΩøÁî®ÈªòËÆ§ÈôêÊµÅÈîôËØØÂ§ÑÁêÜ
                        const errorData = {
                            success: false,
                            error_type: "RATE_LIMIT",
                            message: "ËØ∑Ê±ÇËøá‰∫éÈ¢ëÁπÅÔºåËØ∑Á®çÂêéÈáçËØï",
                            status_code: 429
                        };
                        handleRateLimitError(errorData);
                        return errorData;
                    }
                }
                
                const result = await response.json();
                
                if (response.ok) {
                    // ÂØπ‰∫éÊàêÂäüÁöÑÂìçÂ∫îÔºå‰∏çÊòæÁ§∫ÁªìÊûúÔºàÈÅøÂÖçÂπ≤Êâ∞Áî®Êà∑ÁïåÈù¢Ôºâ
                    hideLoading();
                } else {
                    showResult(result, 'error');
                }
                return result;
            } catch (error) {
                const errorData = {
                    error: error.message,
                    url: url,
                    timestamp: new Date().toISOString()
                };
                showResult(errorData, 'error');
                console.error('APIËØ∑Ê±ÇÂ§±Ë¥•:', error);
                return errorData;
            }
        }

        // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
        function showLoading() {
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result result-loading';
            resultDiv.innerHTML = '<div class="loading-spinner"></div> Â§ÑÁêÜËØ∑Ê±Ç‰∏≠...';
        }

        // ÈöêËóèÂä†ËΩΩÁä∂ÊÄÅ
        function hideLoading() {
            const resultDiv = document.getElementById('result');
            if (resultDiv.className.includes('result-loading')) {
                resultDiv.className = 'result';
                resultDiv.innerHTML = '';
            }
        }

        // Â§ÑÁêÜÈôêÊµÅÈîôËØØÁöÑ‰∏ìÈó®ÂáΩÊï∞
        function handleRateLimitError(errorData) {
            console.warn('üö´ Ëß¶ÂèëÈôêÊµÅ:', errorData);
            
            const errorType = errorData.error_type || errorData.detail?.error_type || 'RATE_LIMIT';
            const message = errorData.message || errorData.detail?.message || 'ËØ∑Ê±ÇËøá‰∫éÈ¢ëÁπÅ';
            const suggestion = errorData.suggestion || errorData.detail?.suggestion || 'ËØ∑Á®çÂêéÈáçËØï';
            const retryAfter = errorData.retry_after_seconds || errorData.detail?.retry_after_seconds || 60;
            const limitValue = errorData.limit_value || errorData.detail?.limit_value;
            const limitType = errorData.limit_type || errorData.detail?.limit_type;
            
            // ÂàõÂª∫ÂèãÂ•ΩÁöÑÈôêÊµÅÊèêÁ§∫
            let rateLimitHtml = `
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 1rem; margin: 1rem 0;">
                    <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                        <span style="font-size: 1.5rem; margin-right: 0.5rem;">‚ö†Ô∏è</span>
                        <strong style="color: #856404;">ËØ∑Ê±ÇÈ¢ëÁéáÈôêÂà∂</strong>
                    </div>
                    
                    <div style="color: #856404; margin-bottom: 1rem;">
                        <p style="margin: 0.5rem 0;"><strong>ÂéüÂõ†:</strong> ${message}</p>
                        <p style="margin: 0.5rem 0;"><strong>Âª∫ËÆÆ:</strong> ${suggestion}</p>
                        
                        ${limitType && limitValue ? `
                            <p style="margin: 0.5rem 0;"><strong>ÂΩìÂâçÈôêÂà∂:</strong> ${limitValue} Ê¨°/${limitType === 'minute' ? 'ÂàÜÈíü' : limitType === 'hour' ? 'Â∞èÊó∂' : 'Â§©'}</p>
                        ` : ''}
                        
                        <p style="margin: 0.5rem 0;"><strong>Á≠âÂæÖÊó∂Èó¥:</strong> ${Math.ceil(retryAfter / 60)} ÂàÜÈíü</p>
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <button onclick="reloadSecurityConfig()" 
                                style="padding: 0.5rem 1rem; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9rem;">
                            ÈáçÊñ∞Âä†ËΩΩÈÖçÁΩÆ
                        </button>
                        
                        <button onclick="checkCurrentLimits()" 
                                style="padding: 0.5rem 1rem; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9rem;">
                            Êü•ÁúãÂΩìÂâçÈôêÂà∂
                        </button>
                        
                        <div id="rateLimitTimer" style="margin-left: auto; font-size: 0.9rem; color: #856404;"></div>
                    </div>
                </div>
            `;
            
            // ÊòæÁ§∫ÈôêÊµÅÈîôËØØ
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result result-warning';
            resultDiv.innerHTML = rateLimitHtml;
            
            // ÂêØÂä®ÂÄíËÆ°Êó∂
            startRetryTimer(retryAfter);
        }

        // ÂÄíËÆ°Êó∂ÂáΩÊï∞
        function startRetryTimer(seconds) {
            const timerDiv = document.getElementById('rateLimitTimer');
            if (!timerDiv) return;
            
            let remainingSeconds = seconds;
            
            const updateTimer = () => {
                const minutes = Math.floor(remainingSeconds / 60);
                const secs = remainingSeconds % 60;
                timerDiv.textContent = `‚è∞ ${minutes}:${secs.toString().padStart(2, '0')} ÂêéÂèØÈáçËØï`;
                
                if (remainingSeconds > 0) {
                    remainingSeconds--;
                    setTimeout(updateTimer, 1000);
                } else {
                    timerDiv.textContent = '‚úÖ Áé∞Âú®ÂèØ‰ª•ÈáçËØï‰∫Ü';
                    timerDiv.style.color = '#28a745';
                }
            };
            
            updateTimer();
        }

        // ÈáçÊñ∞Âä†ËΩΩÂÆâÂÖ®ÈÖçÁΩÆ
        async function reloadSecurityConfig() {
            try {
                showResult('üîÑ Ê≠£Âú®ÈáçÊñ∞Âä†ËΩΩÈÖçÁΩÆ...', 'info');
                const result = await fetch(`${getApiConfig().baseUrl}/api/v1/security/reload-config`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('auth_token') || getApiConfig().apiKey}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await result.json();
                
                if (result.ok && data.success) {
                    showResult(`‚úÖ ${data.message}\n\nÊñ∞ÁöÑÈÖçÁΩÆ:\n${JSON.stringify(data.config, null, 2)}`, 'success');
                } else {
                    showResult(`‚ùå ÈáçÊñ∞Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•: ${data.message || 'Êú™Áü•ÈîôËØØ'}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå ÈáçÊñ∞Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•: ${error.message}`, 'error');
            }
        }

        // Êü•ÁúãÂΩìÂâçÈôêÂà∂
        async function checkCurrentLimits() {
            try {
                showResult('üîç Ê≠£Âú®Êü•ËØ¢ÂΩìÂâçÈôêÂà∂...', 'info');
                const result = await fetch(`${getApiConfig().baseUrl}/api/v1/security/status`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('auth_token') || getApiConfig().apiKey}`
                    }
                });
                
                const data = await result.json();
                
                if (result.ok && data.success) {
                    const config = data.data.config || {};
                    const statusHtml = `
                        üìä ÂΩìÂâçÂÆâÂÖ®ÈÖçÁΩÆ:
                        
                        üîí ÈôêÊµÅÁä∂ÊÄÅ: ${config.rate_limit_enabled ? '‚úÖ Â∑≤ÂêØÁî®' : '‚ùå Â∑≤Á¶ÅÁî®'}
                        üìÖ ÊØèÂàÜÈíüÈôêÂà∂: ${config.requests_per_minute || 'N/A'} Ê¨°
                        üïê ÊØèÂ∞èÊó∂ÈôêÂà∂: ${config.requests_per_hour || 'N/A'} Ê¨°  
                        üìÜ ÊØèÊó•ÈôêÂà∂: ${config.requests_per_day || 'N/A'} Ê¨°
                        
                        üîê ÁôªÂΩïÂÆâÂÖ®:
                        üéØ ÊúÄÂ§ßÂ∞ùËØïÊ¨°Êï∞: ${config.login_max_attempts || 'N/A'} Ê¨°
                        ‚è∞ ÈîÅÂÆöÊó∂Èïø: ${config.lockout_duration_minutes || 'N/A'} ÂàÜÈíü
                    `;
                    showResult(statusHtml, 'info');
                } else {
                    showResult(`‚ùå Êü•ËØ¢ÈôêÂà∂Â§±Ë¥•: ${data.message || 'Êú™Áü•ÈîôËØØ'}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå Êü•ËØ¢ÈôêÂà∂Â§±Ë¥•: ${error.message}`, 'error');
            }
        }

        // ÊòæÁ§∫ÁªìÊûú
        function showResult(data, type = 'info') {
            const resultDiv = document.getElementById('result');
            resultDiv.className = `result result-${type}`;
            
            if (typeof data === 'object') {
                resultDiv.textContent = JSON.stringify(data, null, 2);
            } else {
                resultDiv.innerHTML = data.replace(/\n/g, '<br>');
            }
        }



        // ===== ‰ªªÂä°ÁÆ°ÁêÜÂäüËÉΩ =====

        // Âà∑Êñ∞Á≥ªÁªüÁõëÊéß
        async function refreshSystemMonitor() {
            try {
                console.log('üîÑ ÂºÄÂßãÂà∑Êñ∞Á≥ªÁªüÁõëÊéß...');
                
                // üî• Ê∑ªÂä†Êó∂Èó¥Êà≥Èò≤Ê≠¢ÁºìÂ≠ò
                const timestamp = new Date().getTime();
                const result = await apiRequest(`/api/v1/system/performance/status?_t=${timestamp}`);
                
                console.log('üìä Á≥ªÁªüÁõëÊéßAPIÂìçÂ∫î:', result);
                
                if (result && result.success) {
                    const performance = result.performance_status;
                    const concurrency = performance.concurrency;
                    const scheduler = performance.scheduler;
                    
                    // üî• Êñ∞Â¢ûÔºöÊõ¥Êñ∞ÊÄªÂºÄÂÖ≥Áä∂ÊÄÅÊòæÁ§∫
                    updateMasterSwitchDisplay(scheduler.master_switch || {});
                    
                    // ÂàõÂª∫ÁõëÊéßÊï∞ÊçÆË°å
                    let monitorRows = [];
                    
                    // Á∫øÁ®ãÊ±†Áä∂ÊÄÅË°å
                    monitorRows.push({
                        name: 'Á∫øÁ®ãÊ±†',
                        type: 'ThreadPool',
                        icon: 'üßµ',
                        status: concurrency.thread_pool.initialized ? 'ËøêË°å‰∏≠' : 'Êú™ÂàùÂßãÂåñ',
                        statusColor: concurrency.thread_pool.initialized ? 'success' : 'danger',
                        current: concurrency.thread_pool.initialized ? concurrency.thread_pool.active_threads : 0,
                        max: concurrency.thread_pool.initialized ? concurrency.thread_pool.max_workers : 0,
                        pending: concurrency.thread_pool.initialized ? (concurrency.thread_pool.pending_tasks || 0) : 0,
                        completed: '-',
                        description: concurrency.thread_pool.initialized ? 'I/OÂØÜÈõÜÂûã‰ªªÂä°ÊâßË°åÊ±†' : 'Á∫øÁ®ãÊ±†Êú™ÂàùÂßãÂåñ'
                    });
                    
                    // ÂºÇÊ≠•‰ªªÂä°Áä∂ÊÄÅË°å
                    monitorRows.push({
                        name: 'ÂºÇÊ≠•‰ªªÂä°',
                        type: 'AsyncTasks',
                        icon: 'üìã',
                        status: concurrency.async_tasks.running_tasks > 0 ? `${concurrency.async_tasks.running_tasks} ËøêË°å‰∏≠` : 'Á©∫Èó≤',
                        statusColor: concurrency.async_tasks.running_tasks > 0 ? 'warning' : 'success',
                        current: concurrency.async_tasks.running_tasks,
                        max: '‚àû',
                        pending: 0,
                        completed: concurrency.async_tasks.completed_tasks,
                        description: concurrency.async_tasks.running_task_ids.length > 0 ? 
                                    concurrency.async_tasks.running_task_ids.map(id => id.substring(0, 8)).join(', ') + '...' : 
                                    'ÂêéÂè∞‰ªªÂä°ÁÆ°ÁêÜÂô®'
                    });
                    
                    // üî• Ë∞ÉÂ∫¶Âô®Áä∂ÊÄÅË°å - ËÄÉËôëÊÄªÂºÄÂÖ≥Áä∂ÊÄÅ
                    const masterSwitchEnabled = scheduler.master_switch?.enabled ?? scheduler.master_switch_enabled;
                    const isRunning = scheduler.is_running;
                    const enabledTasks = scheduler.enabled_tasks;
                    
                    // üî• Ë∞ÉËØï‰ø°ÊÅØÔºöËæìÂá∫Áä∂ÊÄÅÂÄº
                    console.log('üîß Ë∞ÉÂ∫¶Âô®Áä∂ÊÄÅË∞ÉËØï:', {
                        masterSwitchEnabled,
                        isRunning,
                        enabledTasks,
                        rawMasterSwitch: scheduler.master_switch,
                        rawMasterSwitchEnabled: scheduler.master_switch_enabled
                    });
                    
                    let schedulerStatus, schedulerStatusColor, schedulerDescription;
                    
                    // üî• ÊúÄÁÆÄÂåñÈÄªËæëÔºöÂè™Ê†πÊçÆÊÄªÂºÄÂÖ≥Áä∂ÊÄÅÂà§Êñ≠
                    if (masterSwitchEnabled) {
                        schedulerStatus = 'ÂºÄÂêØ';
                        schedulerStatusColor = 'success';
                        schedulerDescription = `APSchedulerÂ∑≤ÂºÄÂêØÔºå${enabledTasks}‰∏™ÂêØÁî®‰ªªÂä°`;
                        console.log('üìå Áä∂ÊÄÅÂà§Êñ≠ÔºöÂºÄÂêØÔºàAPSchedulerÊÄªÂºÄÂÖ≥ÂºÄÂêØÔºâ');
                    } else {
                        schedulerStatus = 'ÂÖ≥Èó≠';
                        schedulerStatusColor = 'danger';
                        schedulerDescription = `APSchedulerÊÄªÂºÄÂÖ≥Â∑≤ÂÖ≥Èó≠Ôºå${enabledTasks}‰∏™‰ªªÂä°ÊöÇÂÅúÊâßË°å`;
                        console.log('üìå Áä∂ÊÄÅÂà§Êñ≠ÔºöÂÖ≥Èó≠ÔºàAPSchedulerÊÄªÂºÄÂÖ≥ÂÖ≥Èó≠Ôºâ');
                    }
                    
                    console.log('üéØ ÊúÄÁªàË∞ÉÂ∫¶Âô®Áä∂ÊÄÅ:', {
                        status: schedulerStatus,
                        color: schedulerStatusColor,
                        description: schedulerDescription
                    });
                    
                    monitorRows.push({
                        name: 'APSchedulerË∞ÉÂ∫¶Âô®',
                        type: 'APScheduler',
                        icon: 'üîÑ',
                        status: schedulerStatus,
                        statusColor: schedulerStatusColor,
                        current: scheduler.active_tasks,
                        max: enabledTasks,
                        pending: 0,
                        completed: '-',
                        description: schedulerDescription
                    });
                    
                    // Ê∏≤ÊüìË°®Ê†º
                    console.log('üñºÔ∏è Ê∏≤ÊüìÁ≥ªÁªüÁõëÊéßË°®Ê†ºÔºåÂåÖÂê´Ë∞ÉÂ∫¶Âô®Áä∂ÊÄÅ:', monitorRows[2]); // Á¨¨‰∏âË°åÊòØË∞ÉÂ∫¶Âô®
                    renderSystemMonitorTable(monitorRows);
                } else {
                    const tbody = document.getElementById('systemMonitorTableBody');
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="8" style="padding: 2rem; text-align: center; color: var(--text-secondary);">
                                Ëé∑ÂèñÁ≥ªÁªüÁõëÊéß‰ø°ÊÅØÂ§±Ë¥•: ${result?.message || 'Êú™Áü•ÈîôËØØ'}
                            </td>
                        </tr>
                    `;
                }
            } catch (error) {
                console.error('Âà∑Êñ∞Á≥ªÁªüÁõëÊéßÂ§±Ë¥•:', error);
                const tbody = document.getElementById('systemMonitorTableBody');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="padding: 2rem; text-align: center; color: var(--text-secondary);">
                            ÁΩëÁªúÈîôËØØ: ${error.message}
                        </td>
                    </tr>
                `;
            }
        }

        // Ê∏≤ÊüìÁ≥ªÁªüÁõëÊéßË°®Ê†º
        function renderSystemMonitorTable(monitorRows) {
            const tbody = document.getElementById('systemMonitorTableBody');
            
            console.log('üé® Ê≠£Âú®Ê∏≤ÊüìÁ≥ªÁªüÁõëÊéßË°®Ê†ºÔºåÊï∞ÊçÆË°åÊï∞:', monitorRows.length);
            
            let html = '';
            monitorRows.forEach((row, index) => {
                if (index === 2) { // Ë∞ÉÂ∫¶Âô®Ë°åÔºàÁ¨¨‰∏âË°åÔºâ
                    console.log('üéØ Ê≠£Âú®Ê∏≤ÊüìË∞ÉÂ∫¶Âô®Ë°å:', row);
                }
                html += `
                    <tr style="border-bottom: 1px solid var(--border-color); transition: all 0.2s ease; height: 60px;" 
                        onmouseover="this.style.background='var(--bg-hover)'; this.style.transform='translateX(2px)'" 
                        onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                        <td style="padding: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 16px;">${row.icon}</span>
                                <div>
                                    <div style="font-weight: 600; color: var(--text-primary); font-size: 13px; line-height: 1.3;">${row.name}</div>
                                    <div style="font-size: 11px; color: var(--text-muted); line-height: 1.2;">${row.type}</div>
                                </div>
                            </div>
                        </td>
                        <td style="padding: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle; text-align: center;">
                            <span class="button button-${row.statusColor}" style="padding: 3px 8px; margin: 0; font-size: 11px; font-weight: 500; min-width: auto;">
                                ${row.status}
                            </span>
                        </td>
                        <td style="padding: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle; text-align: center; font-size: 12px; font-weight: 500; color: var(--text-primary);">
                            ${row.current}
                        </td>
                        <td style="padding: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle; text-align: center; font-size: 12px; color: var(--text-secondary);">
                            ${row.max}
                        </td>
                        <td style="padding: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle; text-align: center; font-size: 12px; color: var(--text-secondary);">
                            ${row.pending}
                        </td>
                        <td style="padding: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle; text-align: center; font-size: 12px; color: var(--text-secondary);">
                            ${row.completed}
                        </td>
                        <td style="padding: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle; text-align: center; font-size: 11px; color: var(--text-muted);">
                            ${row.type}
                        </td>
                        <td style="padding: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle; font-size: 11px; color: var(--text-secondary);" title="${row.description}">
                            ${row.description}
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
            
            // üî• Âº∫Âà∂DOMÂà∑Êñ∞ÂíåÁ°ÆËÆ§Êó•Âøó
            tbody.offsetHeight; // Âº∫Âà∂ÈáçÊñ∞ËÆ°ÁÆóÂ∏ÉÂ±Ä
            console.log('‚úÖ Á≥ªÁªüÁõëÊéßË°®Ê†ºÊ∏≤ÊüìÂÆåÊàêÔºåDOMÂ∑≤Êõ¥Êñ∞');
            
            // üî• È™åËØÅÁ¨¨‰∏âË°åÔºàË∞ÉÂ∫¶Âô®ÔºâÁöÑÂÆûÈôÖÊ∏≤ÊüìÂÜÖÂÆπ
            setTimeout(() => {
                const schedulerRow = tbody.children[2]; // Á¨¨‰∏âË°å
                if (schedulerRow) {
                    const statusCell = schedulerRow.children[1]; // Áä∂ÊÄÅÂàó
                    const statusSpan = statusCell.querySelector('span');
                    console.log('üîç È™åËØÅË∞ÉÂ∫¶Âô®Ë°åÊ∏≤ÊüìÁªìÊûú:', {
                        statusText: statusSpan?.textContent,
                        statusClass: statusSpan?.className
                    });
                } else {
                    console.warn('‚ö†Ô∏è Êú™ÊâæÂà∞Ë∞ÉÂ∫¶Âô®Ë°å');
                }
            }, 100);
        }

        // ===== üî• ÊÄªÂºÄÂÖ≥ÊéßÂà∂ÂäüËÉΩ =====
        
        // Êõ¥Êñ∞ÊÄªÂºÄÂÖ≥Áä∂ÊÄÅÊòæÁ§∫
        function updateMasterSwitchDisplay(masterSwitchInfo) {
            const statusText = document.getElementById('masterSwitchText');
            const toggleButton = document.getElementById('masterSwitchToggle');
            
            console.log('üîß Êõ¥Êñ∞ÊÄªÂºÄÂÖ≥ÊòæÁ§∫:', masterSwitchInfo);
            
            if (masterSwitchInfo && typeof masterSwitchInfo.enabled !== 'undefined') {
                const isEnabled = masterSwitchInfo.enabled;
                statusText.textContent = isEnabled ? 'ÂºÄÂêØ' : 'ÂÖ≥Èó≠';
                statusText.style.color = isEnabled ? 'var(--success-color)' : 'var(--danger-color)';
                
                // ÂêØÁî®ÂàáÊç¢ÊåâÈíÆ
                toggleButton.disabled = false;
                toggleButton.className = `button button-small ${isEnabled ? 'button-warning' : 'button-success'}`;
                toggleButton.textContent = isEnabled ? 'ÂÖ≥Èó≠' : 'ÂºÄÂêØ';
                
                console.log('‚úÖ ÊÄªÂºÄÂÖ≥ÊòæÁ§∫Â∑≤Êõ¥Êñ∞:', {
                    enabled: isEnabled,
                    statusText: statusText.textContent,
                    buttonText: toggleButton.textContent
                });
            } else {
                statusText.textContent = 'Êú™Áü•';
                statusText.style.color = 'var(--text-muted)';
                toggleButton.disabled = true;
                toggleButton.className = 'button button-small';
                toggleButton.textContent = 'ÂàáÊç¢';
                
                console.warn('‚ö†Ô∏è ÊÄªÂºÄÂÖ≥‰ø°ÊÅØÊó†Êïà:', masterSwitchInfo);
            }
        }
        
        // ÂàáÊç¢ÊÄªÂºÄÂÖ≥Áä∂ÊÄÅ
        async function toggleMasterSwitch() {
            const toggleButton = document.getElementById('masterSwitchToggle');
            const originalText = toggleButton.textContent;
            const originalClass = toggleButton.className;
            
            try {
                // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
                toggleButton.disabled = true;
                toggleButton.textContent = 'ÂàáÊç¢‰∏≠...';
                toggleButton.className = 'button button-small';
                
                const result = await apiRequest('/api/v1/system/scheduler/master-switch/toggle', 'POST');
                
                if (result && result.success) {
                    // Êõ¥Êñ∞ÊòæÁ§∫
                    updateMasterSwitchDisplay(result.master_switch);
                    
                    // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
                    showResult(`‚úÖ ${result.message}`, 'success');
                    
                    // üî• Á´ãÂç≥Âà∑Êñ∞Á≥ªÁªüÁõëÊéßÔºàÊó†Âª∂ËøüÔºâ
                    console.log('üîÑ ÊÄªÂºÄÂÖ≥ÂàáÊç¢ÊàêÂäüÔºåÁ´ãÂç≥Âà∑Êñ∞Á≥ªÁªüÁõëÊéß...');
                    await refreshSystemMonitor();
                    
                    // üî• ÂÜçÊ¨°Âª∂ËøüÂà∑Êñ∞Á°Æ‰øùÁä∂ÊÄÅÂêåÊ≠•
                    setTimeout(async () => {
                        console.log('üîÑ Âª∂ËøüÂÜçÊ¨°Âà∑Êñ∞Á≥ªÁªüÁõëÊéß...');
                        await refreshSystemMonitor();
                    }, 500);
                } else {
                    throw new Error(result?.message || 'ÂàáÊç¢Â§±Ë¥•');
                }
            } catch (error) {
                console.error('ÂàáÊç¢ÊÄªÂºÄÂÖ≥Â§±Ë¥•:', error);
                showResult(`‚ùå ÂàáÊç¢ÊÄªÂºÄÂÖ≥Â§±Ë¥•: ${error.message}`, 'error');
                
                // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                toggleButton.disabled = false;
                toggleButton.textContent = originalText;
                toggleButton.className = originalClass;
            }
        }
        
        // Ëé∑ÂèñÊÄªÂºÄÂÖ≥Áä∂ÊÄÅÔºàÁã¨Á´ãË∞ÉÁî®Ôºâ
        async function loadMasterSwitchStatus() {
            try {
                const result = await apiRequest('/api/v1/system/scheduler/master-switch');
                
                if (result && result.success) {
                    updateMasterSwitchDisplay(result.master_switch);
                    return result.master_switch;
                } else {
                    console.warn('Ëé∑ÂèñÊÄªÂºÄÂÖ≥Áä∂ÊÄÅÂ§±Ë¥•:', result?.message);
                    return null;
                }
            } catch (error) {
                console.error('Âä†ËΩΩÊÄªÂºÄÂÖ≥Áä∂ÊÄÅÂ§±Ë¥•:', error);
                return null;
            }
        }

        // Âà∑Êñ∞‰ªªÂä°ÈÖçÁΩÆ
        async function refreshTaskConfigs() {
            try {
                console.log('üîÑ ÂºÄÂßãÂà∑Êñ∞‰ªªÂä°ÈÖçÁΩÆ...');
                const result = await apiRequest('/api/v1/tasks/configs');
                console.log('üì• APIÂìçÂ∫î:', result);
                
                if (result && result.success) {
                    console.log('‚úÖ ÊàêÂäüËé∑Âèñ‰ªªÂä°ÈÖçÁΩÆ:', result.data);
                    renderTaskConfigTable(result.data);
                } else {
                    console.warn('‚ö†Ô∏è APIËøîÂõûÂ§±Ë¥•:', result);
                    const tbody = document.getElementById('taskConfigTableBody');
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="11" style="padding: 2rem; text-align: center; color: var(--text-error);">
                                ‚ùå Ëé∑Âèñ‰ªªÂä°ÈÖçÁΩÆÂ§±Ë¥•: ${result?.message || 'Êú™Áü•ÈîôËØØ'}
                                <br><small>ËØ∑Ê£ÄÊü•ÊúçÂä°Áä∂ÊÄÅÊàñÂà∑Êñ∞È°µÈù¢ÈáçËØï</small>
                            </td>
                        </tr>
                    `;
                }
            } catch (error) {
                console.error('‚ùå ‰ªªÂä°ÈÖçÁΩÆËØ∑Ê±ÇÂºÇÂ∏∏:', error);
                const tbody = document.getElementById('taskConfigTableBody');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" style="padding: 2rem; text-align: center; color: var(--text-error);">
                            ‚ùå ÁΩëÁªúÈîôËØØ: ${error.message}
                            <br><small>ËØ∑Ê£ÄÊü•ÊúçÂä°ÊòØÂê¶ÂêØÂä®ÔºåÊàñÁ®çÂêéÈáçËØï</small>
                            <br><button onclick="refreshTaskConfigs()" class="button button-primary" style="margin-top: 8px;">ÈáçËØï</button>
                        </td>
                    </tr>
                `;
            }
        }

        // Ê∏≤Êüì‰ªªÂä°ÈÖçÁΩÆË°®Ê†º
        function renderTaskConfigTable(configs) {
            // ‰øùÂ≠òÈÖçÁΩÆÊï∞ÊçÆÂà∞ÂÖ®Â±ÄÂèòÈáè
            currentTaskConfigs = configs || [];
            
            const tbody = document.getElementById('taskConfigTableBody');
            
            if (!configs || configs.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" style="padding: 2rem; text-align: center; color: var(--text-secondary);">
                            ÊöÇÊó†‰ªªÂä°ÈÖçÁΩÆ
                        </td>
                    </tr>
                `;
                    return;
                }
                
            tbody.innerHTML = configs.map(config => `
                <tr style="border-bottom: 1px solid var(--border-color); transition: all 0.2s ease; height: 60px;" onmouseover="this.style.background='var(--bg-hover)'; this.style.transform='translateX(2px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <td style="padding: 10px; border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle;" title="${config.task_description || config.task_name}">
                        <div style="font-weight: 600; color: var(--text-primary); font-size: 13px; line-height: 1.4; overflow: hidden; text-overflow: ellipsis;">${config.task_name}</div>
                        ${config.task_description ? `<div style="font-size: 11px; color: var(--text-muted); margin-top: 2px; overflow: hidden; text-overflow: ellipsis;">${config.task_description.length > 25 ? config.task_description.substring(0, 25) + '...' : config.task_description}</div>` : ''}
                    </td>
                    <td style="padding: 10px; border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle;">
                        <span style="padding: 3px 8px; background: ${getTaskHandlerBadgeColor(config.task_handler)}; color: white; border-radius: 12px; font-size: 11px; font-weight: 500; white-space: nowrap; box-shadow: var(--shadow-sm);">
                            ${getTaskHandlerLabel(config.task_handler)}
                        </span>
                    </td>
                    <td style="padding: 10px; text-align: center; border-right: 1px solid var(--border-color); white-space: nowrap; vertical-align: middle;">
                        <button onclick="toggleTaskEnabled('${config.task_key}', ${!config.is_enabled})" 
                                class="button ${config.is_enabled ? 'button-success' : 'button-danger'}" 
                                style="padding: 5px 12px; font-size: 11px; min-width: 60px; margin: 0;">
                            ${config.is_enabled ? '‚úì ÁîüÊïà' : '‚úó Â§±Êïà'}
                        </button>
                    </td>
                    <td style="padding: 10px; border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle; font-size: 12px; color: var(--text-secondary);">${formatScheduleDisplay(config)}</td>
                    <td style="padding: 10px; font-size: 11px; border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle; color: var(--text-secondary);">${formatDateTime(config.last_execution_time)}</td>
                    <td style="padding: 10px; font-size: 11px; border-right: 1px solid var(--border-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle; color: var(--text-secondary);">${formatDateTime(config.next_execution_time)}</td>
                    <td style="padding: 10px; text-align: center; border-right: 1px solid var(--border-color); white-space: nowrap; vertical-align: middle;">
                        <div style="font-size: 11px; line-height: 1.3;">
                            <span style="color: var(--text-primary); font-weight: 600;">ÊÄª${config.execution_count}</span>
                            <span style="color: var(--success-color); margin-left: 4px;">‚úì${config.success_count}</span>
                            <span style="color: var(--danger-color); margin-left: 4px;">‚úó${config.failure_count}</span>
                        </div>
                    </td>
                    <td style="padding: 10px; text-align: center; white-space: nowrap; vertical-align: middle;">
                        <div style="display: flex; gap: 3px; justify-content: center; flex-wrap: nowrap;">
                            <button onclick="manualExecuteTask('${config.task_key}')" 
                                    class="button button-warning" 
                                    style="padding: 4px 8px; font-size: 10px; margin: 0;" 
                                    ${!config.is_enabled ? 'disabled' : ''}>
                                ÊâßË°å
                            </button>
                            <button onclick="stopTaskExecution('${config.task_key}')" 
                                    class="button button-danger" 
                                    style="padding: 4px 8px; font-size: 10px; margin: 0;">
                                ÁªàÊ≠¢
                            </button>
                            <button onclick="viewTaskRecords('${config.task_key}', '${config.task_name}')" 
                                    class="button button-primary" 
                                    style="padding: 4px 8px; font-size: 10px; margin: 0;">
                                ËÆ∞ÂΩï
                            </button>
                            <button onclick="editTaskConfig('${config.task_key}')" 
                                    class="button button-outline" 
                                    style="padding: 4px 8px; font-size: 10px; margin: 0;">
                                ÁºñËæë
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // ÂàáÊç¢‰ªªÂä°ÂêØÁî®Áä∂ÊÄÅ
        async function toggleTaskEnabled(taskKey, enabled) {
            const statusText = enabled ? 'ÁîüÊïà' : 'Â§±Êïà';
            const confirmed = confirm(`Á°ÆËÆ§ËÆ©‰ªªÂä° "${taskKey}" ${statusText}Ôºü`);
            if (!confirmed) return;

            try {
                const result = await apiRequest(`/api/v1/tasks/configs/${taskKey}/toggle?enabled=${enabled}`, 'POST');
            if (result && result.success) {
                    showResult(`‚úÖ ‰ªªÂä°Â∑≤${statusText}ÔºÅ`, 'success');
                    // Âà∑Êñ∞Ë°®Ê†º
                    setTimeout(() => refreshTaskConfigs(), 500);
            } else {
                    showResult(`‚ùå Êìç‰ΩúÂ§±Ë¥•: ${result?.message || 'Êú™Áü•ÈîôËØØ'}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå ÁΩëÁªúÈîôËØØ: ${error.message}`, 'error');
            }
        }

        // ÊâãÂä®ÊâßË°å‰ªªÂä°
        let currentExecutionTaskKey = null; // ÂΩìÂâçË¶ÅÊâßË°åÁöÑ‰ªªÂä°ÈîÆ
        let pollingIntervals = new Map(); // Â≠òÂÇ®ËΩÆËØ¢ÂÆöÊó∂Âô®
        let isPollingActive = false; // ÂÖ®Â±ÄËΩÆËØ¢Áä∂ÊÄÅ
        let taskStatusCache = new Map(); // Â≠òÂÇ®‰ªªÂä°Áä∂ÊÄÅÁºìÂ≠òÔºåÁî®‰∫éÊô∫ËÉΩËΩÆËØ¢

        async function manualExecuteTask(taskKey) {
            try {
                currentExecutionTaskKey = taskKey;
                
                if (taskKey === 'customer_service_analysis') {
                    // ÂÆ¢ÊúçÂàÜÊûê‰ªªÂä°ÊòæÁ§∫Êó•ÊúüÈÄâÊã©ÂØπËØùÊ°Ü
                    showDateSelectionModal();
            } else {
                    // ÂÖ∂‰ªñ‰ªªÂä°Áõ¥Êé•ÊâßË°å
                    const confirmed = confirm(`Á°ÆËÆ§ÊâãÂä®ÊâßË°å‰ªªÂä° "${taskKey}"Ôºü`);
                    if (!confirmed) return;
                    
                    showResult(`üöÄ Ê≠£Âú®ÊâãÂä®ÊâßË°å‰ªªÂä°: ${taskKey}...`, 'info');
                    
                    const apiUrl = `/api/v1/tasks/manual-execution/${taskKey}`;
                    const result = await apiRequest(apiUrl, 'POST');
                    
                    if (result && result.success) {
                        const taskId = result.task_id;
                        showResult(`‚úÖ ‰ªªÂä°ÂêØÂä®ÊàêÂäüÔºÅ\n‰ªªÂä°ID: ${taskId || 'N/A'}\n${result.message || ''}\n‚è±Ô∏è Ê≠£Âú®ÁõëÊéß‰ªªÂä°ËøõÂ∫¶...`, 'success');
                        
                        // üî• Êñ∞Â¢ûÔºöÂêØÂä®‰ªªÂä°Áä∂ÊÄÅËΩÆËØ¢
                        if (taskId) {
                            startTaskPolling(taskId, taskKey);
                        }
                        
                        setTimeout(() => refreshTaskConfigs(), 1000);
                    } else {
                        showResult(`‚ùå ‰ªªÂä°ÊâßË°åÂ§±Ë¥•: ${result?.message || 'Êú™Áü•ÈîôËØØ'}`, 'error');
                    }
                }
            } catch (error) {
                console.error('ÊâãÂä®ÊâßË°å‰ªªÂä°ÈîôËØØ:', error);
                showResult(`‚ùå ÁΩëÁªúÈîôËØØ: ${error.message}`, 'error');
            }
        }

        function showDateSelectionModal() {
            // ËÆæÁΩÆÈªòËÆ§ÂºÄÂßãÊó•Êúü‰∏∫3Â§©ÂâçÔºåÁªìÊùüÊó•Êúü‰∏∫Êò®Â§©
            const endDate = new Date();
            endDate.setDate(endDate.getDate() - 1);
            const endDateString = endDate.toISOString().split('T')[0];
            
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - 3);
            const startDateString = startDate.toISOString().split('T')[0];
            
            document.getElementById('taskStartDate').value = startDateString;
            document.getElementById('taskEndDate').value = endDateString;
            document.getElementById('dateSelectionModal').style.display = 'flex';
        }

        function closeDateSelectionModal() {
            document.getElementById('dateSelectionModal').style.display = 'none';
            currentExecutionTaskKey = null;
        }

        async function confirmTaskExecution() {
            try {
                const startDate = document.getElementById('taskStartDate').value;
                const endDate = document.getElementById('taskEndDate').value;
                
                if (!startDate || !endDate) {
                    showResult('‚ùå ËØ∑ÈÄâÊã©ÂºÄÂßãÊó•ÊúüÂíåÁªìÊùüÊó•Êúü', 'error');
                    return;
                }

                // È™åËØÅÊó•ÊúüËåÉÂõ¥
                if (new Date(startDate) >= new Date(endDate)) {
                    showResult('‚ùå ÂºÄÂßãÊó•ÊúüÂøÖÈ°ªÊó©‰∫éÁªìÊùüÊó•Êúü', 'error');
                    return;
                }

                closeDateSelectionModal();
                showResult(`üöÄ Ê≠£Âú®ÊâßË°å‰ªªÂä°: ${currentExecutionTaskKey} (Êó∂Èó¥ËåÉÂõ¥: ${startDate} ~ ${endDate})...`, 'info');

                // ÊûÑÈÄ†Êó∂Èó¥Â≠óÁ¨¶‰∏≤ÔºåÊ∑ªÂä†Êó∂ÂàÜÁßíÈÉ®ÂàÜ
                const startTime = `${startDate}T00:00:00`;
                const endTime = `${endDate}T23:59:59`;

                // ÊûÑÈÄ†URLÂèÇÊï∞
                const params = new URLSearchParams({
                    start_time: startTime,
                    end_time: endTime,
                    loop_analysis: 'true',
                    batch_size: '50'
                });

                // ‰ΩøÁî®Êó∂Èó¥ËåÉÂõ¥API
                const result = await apiRequest(`/api/v1/tasks/full-task-range?${params.toString()}`, 'POST');

                if (result && result.success) {
                    const extractionSummary = result.extraction_summary || {};
                    const analysisSummary = result.analysis_summary || {};
                    
                    const taskId = result.task_id;
                    showResult(`‚úÖ ‰ªªÂä°ÂêØÂä®ÊàêÂäüÔºÅ
‰ªªÂä°ID: ${taskId || 'N/A'}
Êó∂Èó¥ËåÉÂõ¥: ${startDate} ~ ${endDate}
ÊäΩÂèñÊï∞ÊçÆ: ${extractionSummary.extracted || 0} Êù°
ÊàêÂäüÂàÜÊûê: ${analysisSummary.successful || 0} Êù°
‚è±Ô∏è Ê≠£Âú®ÁõëÊéß‰ªªÂä°ËøõÂ∫¶...
${result.message || ''}`, 'success');
                    
                    // ‰ªªÂä°Â∑≤ÂêØÂä®ÔºåÂèØ‰ª•ÁÇπÂáªÊü•ÁúãËÆ∞ÂΩïËøõË°åÁä∂ÊÄÅÁõëÊéß
                    
                    setTimeout(() => refreshTaskConfigs(), 1000);
                } else {
                    showResult(`‚ùå ‰ªªÂä°ÊâßË°åÂ§±Ë¥•: ${result?.message || 'Êú™Áü•ÈîôËØØ'}`, 'error');
                }
            } catch (error) {
                console.error('Á°ÆËÆ§‰ªªÂä°ÊâßË°åÈîôËØØ:', error);
                showResult(`‚ùå ÊâßË°åÂ§±Ë¥•: ${error.message}`, 'error');
            } finally {
                currentExecutionTaskKey = null;
            }
        }

        // ÁªàÊ≠¢‰ªªÂä°ÊâßË°å
        async function stopTaskExecution(taskKey) {
            // È¶ñÂÖàËé∑ÂèñÊ≠£Âú®ËøêË°åÁöÑ‰ªªÂä°
            try {
                const tasksResult = await apiRequest('/api/v1/tasks/records?limit=10&status=running');
                if (!tasksResult || !tasksResult.success) {
                    showResult('‚ùå Êó†Ê≥ïËé∑ÂèñËøêË°å‰∏≠ÁöÑ‰ªªÂä°', 'error');
                return;
            }

                // Êü•Êâæ‰∏éËØ•‰ªªÂä°ÈÖçÁΩÆÁõ∏ÂÖ≥ÁöÑËøêË°å‰∏≠‰ªªÂä°
                const runningTasks = tasksResult.data.filter(task => 
                    task.status === 'running' && 
                    (task.task_name.includes(taskKey) || task.task_type.includes(taskKey.split('_')[0]))
                );

                if (runningTasks.length === 0) {
                    showResult(`‚ö†Ô∏è ‰ªªÂä° "${taskKey}" ÂΩìÂâçÊ≤°ÊúâÊ≠£Âú®ËøêË°åÁöÑÂÆû‰æã`, 'warning');
                return;
            }

                // Â¶ÇÊûúÊúâÂ§ö‰∏™ËøêË°å‰∏≠ÁöÑ‰ªªÂä°ÔºåÁªàÊ≠¢ÊúÄÊñ∞ÁöÑÈÇ£‰∏™
                const taskToStop = runningTasks[0];
                const confirmed = confirm(`Á°ÆËÆ§ÁªàÊ≠¢Ê≠£Âú®ËøêË°åÁöÑ‰ªªÂä°Ôºü\n‰ªªÂä°ID: ${taskToStop.task_id}\n‰ªªÂä°ÂêçÁß∞: ${taskToStop.task_name}`);
                if (!confirmed) return;

                const result = await apiRequest(`/api/v1/tasks/stop/${taskToStop.task_id}?reason=Áî®Êà∑ÊâãÂä®ÁªàÊ≠¢`, 'POST');
            if (result && result.success) {
                    showResult(`‚úÖ ‰ªªÂä°Â∑≤ÁªàÊ≠¢ÔºÅ\n‰ªªÂä°ID: ${taskToStop.task_id}`, 'success');
                    // Âà∑Êñ∞Ë°®Ê†º
                    setTimeout(() => refreshTaskConfigs(), 1000);
            } else {
                    showResult(`‚ùå ÁªàÊ≠¢‰ªªÂä°Â§±Ë¥•: ${result?.message || 'Êú™Áü•ÈîôËØØ'}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå ÁΩëÁªúÈîôËØØ: ${error.message}`, 'error');
            }
        }

        // Êü•Áúã‰ªªÂä°ÊâßË°åËÆ∞ÂΩï
        let currentTaskKey = '';
        let currentTaskName = '';

        async function viewTaskRecords(taskKey, taskName) {
            currentTaskKey = taskKey;
            currentTaskName = taskName;
            
            // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
            document.getElementById('taskRecordsModal').style.display = 'block';
            document.getElementById('taskRecordsModalTitle').textContent = `${taskName} - ÊâßË°åËÆ∞ÂΩï`;
            
            // Âä†ËΩΩÊï∞ÊçÆ
            await loadTaskRecords(taskKey);
        }

                async function loadTaskRecords(taskKey) {
            try {
                document.getElementById('taskRecordsModalBody').innerHTML = `
                    <tr>
                        <td colspan="11" style="padding: 2rem; text-align: center; color: var(--text-secondary);">
                            Âä†ËΩΩ‰∏≠...
                        </td>
                    </tr>
                `;

                // Ê†πÊçÆ‰ªªÂä°keyÂåπÈÖçÁõ∏ÂÖ≥ÁöÑÊâßË°åËÆ∞ÂΩï
                let apiUrl = '/api/v1/tasks/records?limit=100';

                const result = await apiRequest(apiUrl);
                if (result && result.success) {
                    // Áõ¥Êé•‰ΩøÁî®‰ªªÂä°ÈÖçÁΩÆÈîÆËøõË°åÁ≤æÁ°ÆÂåπÈÖç
                    const relatedRecords = result.data.filter(record => {
                        return record.task_config_key === taskKey;
                    });

                    // ÊåâÂºÄÂßãÊó∂Èó¥ÂÄíÂ∫èÊéíÂàó
                    relatedRecords.sort((a, b) => {
                        const timeA = new Date(a.start_time || 0);
                        const timeB = new Date(b.start_time || 0);
                        return timeB - timeA;
                    });

                    renderTaskRecordsModal(relatedRecords);
                    document.getElementById('taskRecordsCount').textContent = `ÂÖ±ÊâæÂà∞ ${relatedRecords.length} Êù°ÊâßË°åËÆ∞ÂΩï`;
                } else {
                    document.getElementById('taskRecordsModalBody').innerHTML = `
                        <tr>
                            <td colspan="11" style="padding: 2rem; text-align: center; color: var(--text-secondary);">
                                Âä†ËΩΩÂ§±Ë¥•: ${result?.message || 'Êú™Áü•ÈîôËØØ'}
                            </td>
                        </tr>
                    `;
                }
            } catch (error) {
                document.getElementById('taskRecordsModalBody').innerHTML = `
                    <tr>
                        <td colspan="11" style="padding: 2rem; text-align: center; color: var(--danger-color);">
                            ÁΩëÁªúÈîôËØØ: ${error.message}
                        </td>
                    </tr>
                `;
            }
        }

        function renderTaskRecordsModal(records) {
            const tbody = document.getElementById('taskRecordsModalBody');
            
            if (!records || records.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" style="padding: 2rem; text-align: center; color: var(--text-secondary);">
                            ÊöÇÊó†ÊâßË°åËÆ∞ÂΩï
                        </td>
                    </tr>
                `;
                return;
            }

                        tbody.innerHTML = records.map(record => `
                <tr style="border-bottom: 1px solid var(--border-color); transition: all 0.2s ease; height: 50px;" onmouseover="this.style.background='var(--bg-hover)'" onmouseout="this.style.background='white'">
                    <td style="padding: 8px; font-family: monospace; font-size: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle;" title="${record.task_id}">
                        ${record.task_id.substring(0, 12)}...
                    </td>
                    <td style="padding: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle;" title="${record.task_name}">
                        <div style="font-weight: 500; font-size: 11px; color: var(--text-primary); overflow: hidden; text-overflow: ellipsis;">${record.task_name.length > 20 ? record.task_name.substring(0, 20) + '...' : record.task_name}</div>
                        ${record.trigger_user ? `<div style="font-size: 9px; color: var(--text-muted); overflow: hidden; text-overflow: ellipsis;">${record.trigger_user}</div>` : ''}
                    </td>
                    <td style="padding: 8px; white-space: nowrap; vertical-align: middle;">
                        <span style="padding: 2px 6px; background: ${getStatusBadgeColor(record.status)}; color: white; border-radius: 8px; font-size: 9px; font-weight: 500; box-shadow: var(--shadow-sm);">
                            ${getStatusLabel(record.status)}
                        </span>
                    </td>
                    <td style="padding: 8px; white-space: nowrap; vertical-align: middle; font-size: 10px; color: var(--text-secondary);">${record.trigger_type === 'manual' ? 'ÊâãÂä®' : 'ÂÆöÊó∂'}</td>
                    <td style="padding: 8px; font-size: 10px; white-space: nowrap; vertical-align: middle; color: var(--text-secondary);">${formatDateTime(record.start_time)}</td>
                    <td style="padding: 8px; font-size: 10px; white-space: nowrap; vertical-align: middle; color: var(--text-secondary);">${formatDateTime(record.end_time)}</td>
                    <td style="padding: 8px; white-space: nowrap; vertical-align: middle; font-size: 10px; color: var(--text-secondary);">${(() => {
                        if (record.status === 'running' && record.start_time && !record.duration_seconds) {
                            const startTime = new Date(record.start_time);
                            const now = new Date();
                            const currentDuration = Math.floor((now - startTime) / 1000);
                            return formatDuration(currentDuration);
                        }
                        return formatDuration(record.duration_seconds);
                    })()}</td>
                    <td style="padding: 8px; text-align: center; white-space: nowrap; vertical-align: middle;">
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
                            <div style="width: 50px; height: 6px; background: #e0e0e0; border-radius: 3px; overflow: hidden;">
                                <div style="height: 100%; background: ${(() => {
                                    const successRecords = record.success_records || 0;
                                    const failedRecords = record.failed_records || 0;
                                    const totalRecords = record.total_records || 0;
                                    let displayProgress;
                                    if (totalRecords > 0 && successRecords === 0 && failedRecords === 0) {
                                        displayProgress = 100;
                                    } else {
                                        displayProgress = record.completion_rate || record.actual_completion_rate || 0;
                                    }
                                    return displayProgress >= 100 ? 'var(--success-color)' : displayProgress >= 50 ? 'var(--warning-color)' : 'var(--danger-color)';
                                })()}; width: ${(() => {
                                    const successRecords = record.success_records || 0;
                                    const failedRecords = record.failed_records || 0;
                                    const totalRecords = record.total_records || 0;
                                    if (totalRecords > 0 && successRecords === 0 && failedRecords === 0) {
                                        return 100;
                                    }
                                    return record.completion_rate || record.actual_completion_rate || 0;
                                })()}%; transition: width 0.3s ease;"></div>
                            </div>
                            <small style="font-size: 9px; color: var(--text-secondary);">${(() => {
                                const successRecords = record.success_records || 0;
                                const failedRecords = record.failed_records || 0;
                                const totalRecords = record.total_records || 0;
                                if (totalRecords > 0 && successRecords === 0 && failedRecords === 0) {
                                    return '100%';
                                }
                                return (record.completion_rate || record.actual_completion_rate || 0).toFixed(1) + '%';
                            })()}</small>
                        </div>
                    </td>
                    <td style="padding: 8px; text-align: center; white-space: nowrap; vertical-align: middle;">
                        <div style="font-size: 10px; line-height: 1.2;">
                            <span style="color: var(--text-primary); font-weight: 600;">ÊÄª${record.total_records || 0}</span>
                            <span style="color: var(--success-color); margin-left: 4px;">‚úì${record.success_records || 0}</span>
                            <span style="color: var(--danger-color); margin-left: 4px;">‚úó${record.failed_records || 0}</span>
                            ${(record.skipped_records || 0) > 0 ? `<span style="color: var(--warning-color); margin-left: 4px;">‚è≠${record.skipped_records}</span>` : ''}
                        </div>
                    </td>
                    <td style="padding: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle; font-size: 10px; color: var(--text-secondary);">
                        ${(() => {
                            const skippedRecords = record.skipped_records || 0;
                            const duplicateRecords = record.duplicate_records || 0;
                            const denoisedRecords = record.denoised_records || 0;
                            if (skippedRecords === 0) return '-';
                            const reasons = [];
                            if (duplicateRecords > 0) reasons.push(`ÈáçÂ§ç${duplicateRecords}`);
                            if (denoisedRecords > 0) reasons.push(`ÂéªÁá•${denoisedRecords}`);
                            const otherSkipped = skippedRecords - duplicateRecords - denoisedRecords;
                            if (otherSkipped > 0) reasons.push(`ÂÖ∂‰ªñ${otherSkipped}`);
                            return reasons.length > 0 ? reasons.join(' ') : 'Êï∞ÊçÆÈáçÂ§ç';
                        })()}
                    </td>
                    <td style="padding: 8px; text-align: center; white-space: nowrap; vertical-align: middle;">
                        <div style="display: flex; gap: 4px; align-items: center; justify-content: center;">
                            <button onclick="viewTaskDetail('${record.task_id}', '${record.task_name}')" 
                                    class="button button-outline"
                                    style="padding: 2px 6px; font-size: 8px; margin: 0; min-width: 35px;">
                                ${record.status === 'running' ? 'ÁõëÊéß' : 'ËØ¶ÊÉÖ'}
                            </button>
                            ${(record.can_terminate || (record.status && ['running', 'pending'].includes(record.status))) ? `
                                <button onclick="terminateTask('${record.task_id}', '${record.task_name}', '${record.status}')" 
                                        class="button"
                                        style="padding: 2px 6px; font-size: 8px; margin: 0; min-width: 35px; background: var(--danger-color); color: white; border: 1px solid var(--danger-color);"
                                        onmouseover="this.style.background='#dc2626'; this.style.borderColor='#dc2626';"
                                        onmouseout="this.style.background='var(--danger-color)'; this.style.borderColor='var(--danger-color)';">
                                    ÁªàÊ≠¢
                                </button>
                            ` : ''}
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        async function refreshTaskRecordsModal() {
            if (currentTaskKey) {
                await loadTaskRecords(currentTaskKey);
            }
        }

        // üî• Êñ∞Â¢ûÔºöÁªàÊ≠¢‰ªªÂä°ÂäüËÉΩ
        async function terminateTask(taskId, taskName, currentStatus) {
            // Á°ÆËÆ§ÂØπËØùÊ°Ü
            const statusDisplayMap = {
                'running': 'ËøêË°å‰∏≠',
                'pending': 'Á≠âÂæÖ‰∏≠'
            };
            
            const statusText = statusDisplayMap[currentStatus] || currentStatus;
            const confirmMessage = `Á°ÆÂÆöË¶ÅÁªàÊ≠¢‰ªªÂä°ÂêóÔºü\n\n‰ªªÂä°ID: ${taskId}\n‰ªªÂä°ÂêçÁß∞: ${taskName}\nÂΩìÂâçÁä∂ÊÄÅ: ${statusText}\n\n‚ö†Ô∏è Ê≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄÔºÅ`;
            
            if (!confirm(confirmMessage)) {
                return;
            }

            try {
                // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
                const originalButton = event.target;
                const originalText = originalButton.textContent;
                originalButton.textContent = 'ÁªàÊ≠¢‰∏≠...';
                originalButton.disabled = true;
                originalButton.style.opacity = '0.6';

                // Ë∞ÉÁî®ÁªàÊ≠¢API
                const response = await fetch(`/api/v1/tasks/stop/${encodeURIComponent(taskId)}?reason=${encodeURIComponent('Áî®Êà∑ÊâãÂä®ÁªàÊ≠¢')}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    // ÊàêÂäüÁªàÊ≠¢
                    showResult(`‚úÖ ‰ªªÂä°ÁªàÊ≠¢ÊàêÂäü: ${result.message}`, 'success');
                    
                    // Âà∑Êñ∞‰ªªÂä°ËÆ∞ÂΩïÂàóË°®
                    await refreshTaskRecordsModal();
                    
                } else {
                    // ÁªàÊ≠¢Â§±Ë¥•
                    const errorMsg = result.message || result.detail || 'Êú™Áü•ÈîôËØØ';
                    showResult(`‚ùå ‰ªªÂä°ÁªàÊ≠¢Â§±Ë¥•: ${errorMsg}`, 'error');
                    
                    // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                    originalButton.textContent = originalText;
                    originalButton.disabled = false;
                    originalButton.style.opacity = '1';
                }

            } catch (error) {
                console.error('ÁªàÊ≠¢‰ªªÂä°Êó∂ÂèëÁîüÈîôËØØ:', error);
                showResult(`‚ùå ÁΩëÁªúÈîôËØØ: ${error.message}`, 'error');
                
                // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                const button = event.target;
                button.textContent = 'ÁªàÊ≠¢';
                button.disabled = false;
                button.style.opacity = '1';
            }
        }

        // üî• Êñ∞Â¢ûÔºöÊâπÈáèÁªàÊ≠¢‰ªªÂä°ÂäüËÉΩÔºàÈ¢ÑÁïôÔºâ
        async function batchTerminateTasks(taskIds) {
            if (!taskIds || taskIds.length === 0) {
                showResult('‚ùå ËØ∑ÈÄâÊã©Ë¶ÅÁªàÊ≠¢ÁöÑ‰ªªÂä°', 'error');
                return;
            }

            const confirmMessage = `Á°ÆÂÆöË¶ÅÊâπÈáèÁªàÊ≠¢ ${taskIds.length} ‰∏™‰ªªÂä°ÂêóÔºü\n\n‚ö†Ô∏è Ê≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄÔºÅ`;
            
            if (!confirm(confirmMessage)) {
                return;
            }

            try {
                const response = await fetch('/api/v1/tasks/stop/batch?reason=' + encodeURIComponent('Áî®Êà∑ÊâπÈáèÁªàÊ≠¢'), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(taskIds)
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    showResult(`‚úÖ ÊâπÈáèÁªàÊ≠¢ÂÆåÊàê: ${result.message}`, 'success');
                    
                    // Âà∑Êñ∞‰ªªÂä°ËÆ∞ÂΩïÂàóË°®
                    await refreshTaskRecordsModal();
                    
                } else {
                    const errorMsg = result.message || result.detail || 'Êú™Áü•ÈîôËØØ';
                    showResult(`‚ùå ÊâπÈáèÁªàÊ≠¢Â§±Ë¥•: ${errorMsg}`, 'error');
                }

            } catch (error) {
                console.error('ÊâπÈáèÁªàÊ≠¢‰ªªÂä°Êó∂ÂèëÁîüÈîôËØØ:', error);
                showResult(`‚ùå ÁΩëÁªúÈîôËØØ: ${error.message}`, 'error');
            }
        }

        function closeTaskRecordsModal() {
            document.getElementById('taskRecordsModal').style.display = 'none';
            currentTaskKey = '';
            currentTaskName = '';
        }

        /**
         * Êü•Áúã‰ªªÂä°ËØ¶ÊÉÖÂπ∂ÂºÄÂßãËΩÆËØ¢Ôºà‰ªÖÈÄÇÁî®‰∫éËøêË°å‰∏≠ÁöÑ‰ªªÂä°Ôºâ
         * @param {string} taskId - ‰ªªÂä°ID
         * @param {string} taskName - ‰ªªÂä°ÂêçÁß∞
         */
        async function viewTaskDetail(taskId, taskName) {
            try {
                // Ëé∑Âèñ‰ªªÂä°ËØ¶ÊÉÖ
                const result = await apiRequest(`/api/v1/tasks/records/${taskId}`, 'GET');
                
                if (result && result.success && result.data) {
                    const taskData = result.data;
                    const status = taskData.status;
                    
                    // ÊòæÁ§∫‰ªªÂä°ËØ¶ÊÉÖ‰ø°ÊÅØ
                    const detailsHtml = `
                        <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <h4 style="margin: 0 0 0.5rem 0; color: var(--text-primary);">üìã ${taskName}</h4>
                            <p style="margin: 0; color: var(--text-secondary); font-family: monospace; font-size: 0.9rem;">ID: ${taskId}</p>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                            <div>
                                <strong>Áä∂ÊÄÅ:</strong> <span style="color: ${getStatusColor(status)};">${getStatusLabel(status)}</span>
                            </div>
                            <div>
                                <strong>ËøõÂ∫¶:</strong> ${(taskData.completion_rate || 0).toFixed(1)}%
                            </div>
                            <div>
                                <strong>ÂºÄÂßãÊó∂Èó¥:</strong> ${formatDateTime(taskData.start_time)}
                            </div>
                            <div>
                                <strong>Â§ÑÁêÜÈò∂ÊÆµ:</strong> ${taskData.process_stage || 'Êú™Áü•'}
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; text-align: center; margin-bottom: 1rem;">
                            <div style="background: var(--bg-primary); padding: 0.5rem; border-radius: 4px;">
                                <div style="font-weight: 600; color: var(--text-primary);">${taskData.total_records || 0}</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">ÊÄªËÆ°</div>
                            </div>
                            <div style="background: var(--success-color); color: white; padding: 0.5rem; border-radius: 4px;">
                                <div style="font-weight: 600;">${taskData.success_records || 0}</div>
                                <div style="font-size: 0.8rem;">ÊàêÂäü</div>
                            </div>
                            <div style="background: var(--danger-color); color: white; padding: 0.5rem; border-radius: 4px;">
                                <div style="font-weight: 600;">${taskData.failed_records || 0}</div>
                                <div style="font-size: 0.8rem;">Â§±Ë¥•</div>
                            </div>
                            <div style="background: var(--warning-color); color: white; padding: 0.5rem; border-radius: 4px;">
                                <div style="font-weight: 600;">${taskData.skipped_records || 0}</div>
                                <div style="font-size: 0.8rem;">Ë∑≥Ëøá</div>
                            </div>
                        </div>
                        
                        ${status === 'running' ? `
                            <div style="background: var(--primary-color); color: white; padding: 0.75rem; border-radius: 6px; text-align: center; margin-bottom: 1rem;">
                                üîÑ ÂºÄÂßãÁõëÊéß‰ªªÂä°ËøõÂ∫¶ÔºàÊØè5ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°Ôºâ
                                <button onclick="stopTaskPolling('${taskId}')" style="margin-left: 1rem; padding: 0.25rem 0.5rem; font-size: 0.8rem; border: 1px solid white; background: transparent; color: white; border-radius: 4px; cursor: pointer;">
                                    ÂÅúÊ≠¢ÁõëÊéß
                                </button>
                            </div>
                        ` : ''}
                    `;
                    
                    showResult(detailsHtml, 'info');
                    
                    // Â¶ÇÊûúÊòØËøêË°å‰∏≠ÁöÑ‰ªªÂä°ÔºåÂºÄÂßãËΩÆËØ¢
                    if (status === 'running') {
                        console.log(`üîÑ ÂºÄÂßãÁõëÊéß‰ªªÂä°ËøõÂ∫¶: ${taskId}`);
                        await startTaskPolling(taskId, taskData.task_config_key || taskData.task_type);
                    }
                    
                } else {
                    showResult(`‚ùå Êó†Ê≥ïËé∑Âèñ‰ªªÂä°ËØ¶ÊÉÖ: ${result?.message || 'Êú™Áü•ÈîôËØØ'}`, 'error');
                }
            } catch (error) {
                console.error('Êü•Áúã‰ªªÂä°ËØ¶ÊÉÖÂ§±Ë¥•:', error);
                showResult(`‚ùå Êü•Áúã‰ªªÂä°ËØ¶ÊÉÖÂ§±Ë¥•: ${error.message}`, 'error');
            }
        }

        // ËæÖÂä©ÂáΩÊï∞ÔºöËé∑ÂèñÁä∂ÊÄÅÈ¢úËâ≤
        function getStatusColor(status) {
            const colors = {
                'running': '#2196F3',
                'completed': '#4CAF50', 
                'failed': '#f44336',
                'cancelled': '#FF9800'
            };
            return colors[status] || '#6c757d';
        }

        // ÁºñËæë‰ªªÂä°ÈÖçÁΩÆ
        function editTaskConfig(taskKey) {
            showTaskConfigEditModal(taskKey);
        }

        // ÊòæÁ§∫‰ªªÂä°ÈÖçÁΩÆÁºñËæëÊ®°ÊÄÅÊ°Ü
        function showTaskConfigEditModal(taskKey) {
            // Ëé∑ÂèñÂΩìÂâçÈÖçÁΩÆ
            const config = currentTaskConfigs.find(c => c.task_key === taskKey);
            if (!config) {
                showResult('‚ùå Êâæ‰∏çÂà∞‰ªªÂä°ÈÖçÁΩÆ', 'error');
                return;
            }
            
            const modal = document.getElementById('taskConfigEditModal') || createTaskConfigEditModal();
            
            // üöÄ Âà§Êñ≠ÂΩìÂâç‰ΩøÁî®ÁöÑË∞ÉÂ∫¶Ê®°Âºè
            const hasCron = config.schedule_cron && config.schedule_cron.trim();
            const scheduleMode = hasCron ? 'cron' : 'interval';
            
            // Â°´ÂÖÖÂü∫Êú¨‰ø°ÊÅØ
            document.getElementById('editTaskName').textContent = config.task_name;
            document.getElementById('editTaskKey').textContent = config.task_key;
            
            // ËÆæÁΩÆË∞ÉÂ∫¶Ê®°Âºè
            document.getElementById('scheduleMode').value = scheduleMode;
            
            if (scheduleMode === 'cron') {
                // CRONÊ®°Âºè
                document.getElementById('cronInput').value = config.schedule_cron || '';
                showCronMode();
            } else {
                // Èó¥ÈöîÊ®°Âºè
                const currentSeconds = config.schedule_interval;
                let displayValue = currentSeconds;
                let selectedUnit = 'seconds';
                
                if (currentSeconds >= 86400 && currentSeconds % 86400 === 0) {
                    displayValue = currentSeconds / 86400;
                    selectedUnit = 'days';
                } else if (currentSeconds >= 3600 && currentSeconds % 3600 === 0) {
                    displayValue = currentSeconds / 3600;
                    selectedUnit = 'hours';
                } else if (currentSeconds >= 60 && currentSeconds % 60 === 0) {
                    displayValue = currentSeconds / 60;
                    selectedUnit = 'minutes';
                }
                
                document.getElementById('editIntervalValue').value = displayValue;
                document.getElementById('editIntervalUnit').value = selectedUnit;
                showIntervalMode();
            }
            
            modal.style.display = 'flex';
            currentEditingTaskKey = taskKey;
        }

        // ÂàõÂª∫‰ªªÂä°ÈÖçÁΩÆÁºñËæëÊ®°ÊÄÅÊ°Ü
        function createTaskConfigEditModal() {
            const modal = document.createElement('div');
            modal.id = 'taskConfigEditModal';
            modal.style.cssText = `
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(92, 100, 244, 0.1);
                backdrop-filter: blur(8px);
                z-index: 1000;
                justify-content: center;
                align-items: center;
            `;

            modal.innerHTML = `
                <div onclick="event.stopPropagation()" style="background: white; border-radius: 16px; padding: 2rem; max-width: 520px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: var(--shadow-lg); border: 1px solid var(--border-color);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color);">
                        <h3 style="margin: 0; color: var(--text-primary); font-size: 18px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                            <span style="color: var(--primary-color);">‚öôÔ∏è</span>
                            ÁºñËæë‰ªªÂä°ÈÖçÁΩÆ
                        </h3>
                        <button onclick="closeTaskConfigEditModal()" style="background: none; border: none; font-size: 20px; cursor: pointer; color: var(--text-secondary); padding: 8px; border-radius: 50%; transition: all 0.2s ease;" onmouseover="this.style.background='var(--bg-hover)'" onmouseout="this.style.background='none'">&times;</button>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-primary); border-radius: var(--radius-md);">
                        <div style="margin-bottom: 0.75rem;">
                            <strong style="color: var(--text-primary);">‰ªªÂä°ÂêçÁß∞Ôºö</strong> 
                            <span id="editTaskName" style="color: var(--text-secondary);"></span>
                        </div>
                        <div>
                            <strong style="color: var(--text-primary);">‰ªªÂä°Ê†áËØÜÔºö</strong> 
                            <span id="editTaskKey" style="font-family: 'Monaco', 'Menlo', monospace; color: var(--text-secondary); background: white; padding: 0.125rem 0.25rem; border-radius: 3px; font-size: 0.85rem;"></span>
                        </div>
                    </div>

                    <!-- üöÄ Ë∞ÉÂ∫¶Ê®°ÂºèÈÄâÊã©Âô® -->
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.75rem; font-weight: 600; color: var(--text-primary);">üîÑ Ë∞ÉÂ∫¶Ê®°Âºè</label>
                        <select id="scheduleMode" onchange="toggleScheduleMode()"
                                style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: var(--radius-md); background: white; font-size: 1rem; cursor: pointer; transition: border-color 0.2s;"
                                onfocus="this.style.borderColor='var(--primary-color)'"
                                onblur="this.style.borderColor='var(--border-color)'">
                            <option value="interval">Èó¥ÈöîË∞ÉÂ∫¶ - ÊåâÂõ∫ÂÆöÊó∂Èó¥Èó¥ÈöîÊâßË°å</option>
                            <option value="cron">CRONË∞ÉÂ∫¶ - ‰ΩøÁî®CRONË°®ËææÂºèÁ≤æÁ°ÆÊéßÂà∂</option>
                        </select>
                    </div>

                    <!-- üöÄ CRONÊ®°ÂºèÁïåÈù¢ -->
                    <div id="cronModeDiv" style="display: none; margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.75rem; font-weight: 600; color: var(--text-primary);">‚è∞ CRONË°®ËææÂºè</label>
                        <div style="margin-bottom: 0.75rem;">
                            <input type="text" id="cronInput" 
                                   style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: var(--radius-md); font-size: 1rem; font-family: 'Monaco', 'Menlo', monospace; transition: border-color 0.2s;"
                                   placeholder="0 9 * * 1-5  (Â∑•‰ΩúÊó•‰∏äÂçà9ÁÇπ)"
                                   oninput="validateCronExpression()"
                                   onfocus="this.style.borderColor='var(--primary-color)'"
                                   onblur="this.style.borderColor='var(--border-color)'">
                        </div>
                        <div id="cronValidation" style="margin-bottom: 0.75rem;"></div>
                        <div id="cronPreview" style="margin-bottom: 0.75rem;"></div>
                        
                        <div style="margin-bottom: 0.75rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-primary); font-size: 0.9rem;">üéØ CRONÁ§∫‰æãÔºö</label>
                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.5rem;">
                                <button type="button" onclick="setCronExample('0 */2 * * *')" class="button" style="font-size: 0.8rem; padding: 0.25rem 0.5rem; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-color);">ÊØè2Â∞èÊó∂</button>
                                <button type="button" onclick="setCronExample('0 9 * * 1-5')" class="button" style="font-size: 0.8rem; padding: 0.25rem 0.5rem; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-color);">Â∑•‰ΩúÊó•9ÁÇπ</button>
                                <button type="button" onclick="setCronExample('*/30 * * * *')" class="button" style="font-size: 0.8rem; padding: 0.25rem 0.5rem; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-color);">ÊØè30ÂàÜÈíü</button>
                                <button type="button" onclick="setCronExample('0 0 */3 * *')" class="button" style="font-size: 0.8rem; padding: 0.25rem 0.5rem; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-color);">ÊØè3Â§©</button>
                                <button type="button" onclick="setCronExample('0 8,12,18 * * *')" class="button" style="font-size: 0.8rem; padding: 0.25rem 0.5rem; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-color);">‰∏âÈ§êÊó∂Èó¥</button>
                            </div>
                        </div>
                        
                        <div style="padding: 0.75rem; background: #e0f2fe; border-radius: var(--radius-md); border-left: 4px solid #0288d1;">
                            <small style="color: #01579b; font-weight: 500;">
                                üìù <strong>CRONÊ†ºÂºè:</strong> ÂàÜÈíü Â∞èÊó∂ Êó•Êúü Êúà‰ªΩ ÊòüÊúü (‰æã: 0 9 * * 1-5 = Â∑•‰ΩúÊó•‰∏äÂçà9ÁÇπ)
                            </small>
                        </div>
                    </div>

                    <!-- üîÑ Èó¥ÈöîÊ®°ÂºèÁïåÈù¢ -->
                    <div id="intervalModeDiv" style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.75rem; font-weight: 600; color: var(--text-primary);">‚è∞ Ë∞ÉÂ∫¶Èó¥Èöî</label>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <input type="number" id="editIntervalValue" min="1" step="1" 
                                   style="flex: 1; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: var(--radius-md); font-size: 1rem; transition: border-color 0.2s;"
                                   placeholder="ËæìÂÖ•Êï∞ÂÄº"
                                   onfocus="this.style.borderColor='var(--primary-color)'"
                                   onblur="this.style.borderColor='var(--border-color)'">
                            <select id="editIntervalUnit" 
                                    style="padding: 0.75rem; border: 1px solid var(--border-color); border-radius: var(--radius-md); background: white; font-size: 1rem; cursor: pointer; transition: border-color 0.2s;"
                                    onfocus="this.style.borderColor='var(--primary-color)'"
                                    onblur="this.style.borderColor='var(--border-color)'">
                                <option value="seconds">Áßí</option>
                                <option value="minutes">ÂàÜÈíü</option>
                                <option value="hours">Â∞èÊó∂</option>
                                <option value="days">Â§©</option>
                            </select>
                        </div>
                        <div style="margin-top: 0.75rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-primary); font-size: 0.9rem;">üéØ Âø´ÈÄüËÆæÁΩÆÔºö</label>
                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                <button type="button" onclick="setQuickInterval(30, 'minutes')" class="button" style="font-size: 0.8rem; padding: 0.25rem 0.5rem; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-color);">30ÂàÜÈíü</button>
                                <button type="button" onclick="setQuickInterval(1, 'hours')" class="button" style="font-size: 0.8rem; padding: 0.25rem 0.5rem; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-color);">1Â∞èÊó∂</button>
                                <button type="button" onclick="setQuickInterval(4, 'hours')" class="button" style="font-size: 0.8rem; padding: 0.25rem 0.5rem; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-color);">4Â∞èÊó∂</button>
                                <button type="button" onclick="setQuickInterval(6, 'hours')" class="button" style="font-size: 0.8rem; padding: 0.25rem 0.5rem; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-color);">6Â∞èÊó∂</button>
                                <button type="button" onclick="setQuickInterval(12, 'hours')" class="button" style="font-size: 0.8rem; padding: 0.25rem 0.5rem; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-color);">12Â∞èÊó∂</button>
                                <button type="button" onclick="setQuickInterval(1, 'days')" class="button" style="font-size: 0.8rem; padding: 0.25rem 0.5rem; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-color);">1Â§©</button>
                                <button type="button" onclick="setQuickInterval(3, 'days')" class="button" style="font-size: 0.8rem; padding: 0.25rem 0.5rem; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-color);">3Â§©</button>
                            </div>
                        </div>
                        <div style="margin-top: 0.75rem; padding: 0.75rem; background: #fef3c7; border-radius: var(--radius-md); border-left: 4px solid var(--warning-color);">
                            <small style="color: #92400e; font-weight: 500;">
                                üí° <strong>Âª∫ËÆÆ:</strong> ‰∏ÄËà¨‰ªªÂä°Âª∫ËÆÆ4-6Â∞èÊó∂ÔºåÊï∞ÊçÆÂØÜÈõÜÂûã‰ªªÂä°Âª∫ËÆÆ1-2Â§©
                            </small>
                        </div>
                    </div>

                    <div style="display: flex; gap: 0.75rem; justify-content: flex-end; margin-top: 2rem;">
                        <button onclick="closeTaskConfigEditModal()" 
                                class="button" 
                                style="background: var(--text-secondary); color: white; padding: 0.75rem 1.5rem;">ÂèñÊ∂à</button>
                        <button onclick="saveTaskConfigEdit()" 
                                class="button button-primary" 
                                style="padding: 0.75rem 1.5rem;">üíæ ‰øùÂ≠ò‰øÆÊîπ</button>
                    </div>
                </div>
            `;

            // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
            modal.onclick = (e) => {
                if (e.target === modal) {
                    closeTaskConfigEditModal();
                }
            };

            document.body.appendChild(modal);
            return modal;
        }

        // ÂÖ≥Èó≠ÁºñËæëÊ®°ÊÄÅÊ°Ü
        function closeTaskConfigEditModal() {
            const modal = document.getElementById('taskConfigEditModal');
            if (modal) {
                modal.style.display = 'none';
            }
            currentEditingTaskKey = null;
        }

        // ‰øùÂ≠ò‰ªªÂä°ÈÖçÁΩÆÁºñËæë
        function saveTaskConfigEdit() {
            const scheduleMode = document.getElementById('scheduleMode').value;
            let updates = {};

            if (scheduleMode === 'cron') {
                // üöÄ CRONÊ®°Âºè
                const cronExpr = document.getElementById('cronInput').value.trim();
                
                if (!cronExpr) {
                    showResult('‚ùå ËØ∑ËæìÂÖ•CRONË°®ËææÂºè', 'error');
                    return;
                }

                // È™åËØÅCRONË°®ËææÂºè
                if (!isValidCronExpression(cronExpr)) {
                    showResult('‚ùå CRONË°®ËææÂºèÊ†ºÂºèÊó†ÊïàÔºåËØ∑Ê£ÄÊü•Ê†ºÂºè', 'error');
                    return;
                }

                updates.schedule_cron = cronExpr;
                updates.schedule_interval = null; // Ê∏ÖÁ©∫interval
                
            } else {
                // üîÑ Èó¥ÈöîÊ®°Âºè
                const value = parseInt(document.getElementById('editIntervalValue').value);
                const unit = document.getElementById('editIntervalUnit').value;

                if (!value || value <= 0) {
                    showResult('‚ùå ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÊï∞ÂÄº', 'error');
                    return;
                }

                // ËΩ¨Êç¢‰∏∫Áßí
                let seconds = value;
                switch (unit) {
                    case 'minutes':
                        seconds = value * 60;
                        break;
                    case 'hours':
                        seconds = value * 3600;
                        break;
                    case 'days':
                        seconds = value * 86400;
                        break;
                }

                // È™åËØÅÂêàÁêÜËåÉÂõ¥
                if (seconds < 60) {
                    showResult('‚ùå Ë∞ÉÂ∫¶Èó¥Èöî‰∏çËÉΩÂ∞ë‰∫é1ÂàÜÈíü', 'error');
                    return;
                }

                if (seconds > 86400 * 30) {
                    showResult('‚ùå Ë∞ÉÂ∫¶Èó¥Èöî‰∏çËÉΩË∂ÖËøá30Â§©', 'error');
                    return;
                }

                updates.schedule_interval = seconds;
                updates.schedule_cron = null; // Ê∏ÖÁ©∫cron
            }

            updateTaskConfig(currentEditingTaskKey, updates);
            closeTaskConfigEditModal();
        }

        // Âø´ÈÄüËÆæÁΩÆÊó∂Èó¥Èó¥Èöî
        function setQuickInterval(value, unit) {
            document.getElementById('editIntervalValue').value = value;
            document.getElementById('editIntervalUnit').value = unit;
            
            // Ê∑ªÂä†ËßÜËßâÂèçÈ¶à
            const input = document.getElementById('editIntervalValue');
            const select = document.getElementById('editIntervalUnit');
            
            input.style.borderColor = 'var(--success-color)';
            select.style.borderColor = 'var(--success-color)';
            
            setTimeout(() => {
                input.style.borderColor = 'var(--border-color)';
                select.style.borderColor = 'var(--border-color)';
            }, 1000);
        }

        // ÂÖ®Â±ÄÂèòÈáè
        let currentEditingTaskKey = null;
        let currentTaskConfigs = [];

        // Êõ¥Êñ∞‰ªªÂä°ÈÖçÁΩÆ
        async function updateTaskConfig(taskKey, updates) {
            try {
                const result = await apiRequest(`/api/v1/tasks/configs/${taskKey}`, 'PUT', updates);
                if (result && result.success) {
                    showResult(`‚úÖ ${result.message}`, 'success');
                    // Âà∑Êñ∞Ë°®Ê†º
                    setTimeout(() => refreshTaskConfigs(), 500);
                } else {
                    showResult(`‚ùå Êõ¥Êñ∞Â§±Ë¥•: ${result?.message || 'Êú™Áü•ÈîôËØØ'}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå ÁΩëÁªúÈîôËØØ: ${error.message}`, 'error');
            }
        }

        // üöÄ ==================== CRONÂäüËÉΩÁõ∏ÂÖ≥ÂáΩÊï∞ ====================

        // ÂàáÊç¢Ë∞ÉÂ∫¶Ê®°Âºè
        function toggleScheduleMode() {
            const scheduleMode = document.getElementById('scheduleMode').value;
            if (scheduleMode === 'cron') {
                showCronMode();
            } else {
                showIntervalMode();
            }
        }

        // ÊòæÁ§∫CRONÊ®°ÂºèÁïåÈù¢
        function showCronMode() {
            document.getElementById('cronModeDiv').style.display = 'block';
            document.getElementById('intervalModeDiv').style.display = 'none';
            
            // Ëß¶Âèë‰∏ÄÊ¨°È™åËØÅ‰ª•ÊòæÁ§∫ÂΩìÂâçÁä∂ÊÄÅ
            setTimeout(() => validateCronExpression(), 100);
        }

        // ÊòæÁ§∫Èó¥ÈöîÊ®°ÂºèÁïåÈù¢
        function showIntervalMode() {
            document.getElementById('cronModeDiv').style.display = 'none';
            document.getElementById('intervalModeDiv').style.display = 'block';
        }

        // ËÆæÁΩÆCRONÁ§∫‰æã
        function setCronExample(cronExpr) {
            document.getElementById('cronInput').value = cronExpr;
            validateCronExpression();
        }

        // È™åËØÅCRONË°®ËææÂºèÔºàÂâçÁ´ØÁÆÄÂçïÈ™åËØÅÔºâ
        function isValidCronExpression(cronExpr) {
            if (!cronExpr || !cronExpr.trim()) return false;
            
            const parts = cronExpr.trim().split(/\s+/);
            if (parts.length !== 5) return false;
            
            // ÁÆÄÂçïÁöÑÂ≠óÊÆµÈ™åËØÅ
            const ranges = [
                [0, 59],  // ÂàÜÈíü
                [0, 23],  // Â∞èÊó∂
                [1, 31],  // Êó•
                [1, 12],  // Êúà
                [0, 6]    // Âë®
            ];
            
            for (let i = 0; i < parts.length; i++) {
                const field = parts[i];
                if (field === '*') continue;
                
                // È™åËØÅÊï∞ÂÄºËåÉÂõ¥ÔºàÁÆÄÂåñÁâàÔºâ
                if (/^\d+$/.test(field)) {
                    const num = parseInt(field);
                    if (num < ranges[i][0] || num > ranges[i][1]) {
                        return false;
                    }
                }
                // ÂÖ∂‰ªñÊ†ºÂºèÔºàËåÉÂõ¥„ÄÅÂàóË°®„ÄÅÊ≠•ÈïøÔºâÊöÇÊó∂ËÆ§‰∏∫ÊúâÊïà
            }
            
            return true;
        }

        // ÂÆûÊó∂È™åËØÅCRONË°®ËææÂºè
        async function validateCronExpression() {
            const cronInput = document.getElementById('cronInput');
            const cronValidation = document.getElementById('cronValidation');
            const cronPreview = document.getElementById('cronPreview');
            
            const cronExpr = cronInput.value.trim();
            
            if (!cronExpr) {
                cronValidation.innerHTML = '';
                cronPreview.innerHTML = '';
                cronInput.style.borderColor = 'var(--border-color)';
                return;
            }
            
            // ÂâçÁ´ØÂø´ÈÄüÈ™åËØÅ
            if (!isValidCronExpression(cronExpr)) {
                cronValidation.innerHTML = `
                    <div style="padding: 0.5rem; background: #fee2e2; border-radius: var(--radius-md); border-left: 4px solid #dc2626;">
                        <small style="color: #dc2626; font-weight: 500;">‚ùå Ê†ºÂºèÈîôËØØÔºöCRONË°®ËææÂºèÂøÖÈ°ªÂåÖÂê´5‰∏™Â≠óÊÆµ</small>
                    </div>
                `;
                cronPreview.innerHTML = '';
                cronInput.style.borderColor = '#dc2626';
                return;
            }
            
            // Ë∞ÉÁî®ÂêéÁ´ØÈ™åËØÅAPI
            try {
                const response = await apiRequest('/api/v1/tasks/validate-cron', 'POST', {
                    cron_expression: cronExpr
                });
                
                if (response && response.success) {
                    // È™åËØÅÊàêÂäü
                    cronValidation.innerHTML = `
                        <div style="padding: 0.5rem; background: #dcfce7; border-radius: var(--radius-md); border-left: 4px solid #16a34a;">
                            <small style="color: #16a34a; font-weight: 500;">‚úÖ ${response.message}</small>
                        </div>
                    `;
                    
                    // ÊòæÁ§∫ÊèèËø∞ÂíåÈ¢ÑËßàÊó∂Èó¥
                    let previewHtml = '';
                    if (response.description) {
                        previewHtml += `<div style="margin-bottom: 0.5rem;"><strong>ÊèèËø∞Ôºö</strong>${response.description}</div>`;
                    }
                    if (response.next_runs && response.next_runs.length > 0) {
                        previewHtml += `
                            <div><strong>Êé•‰∏ãÊù•ÊâßË°åÊó∂Èó¥Ôºö</strong></div>
                            <ul style="margin: 0.25rem 0; padding-left: 1.25rem; font-size: 0.9rem; color: var(--text-secondary);">
                                ${response.next_runs.map(time => `<li>${time}</li>`).join('')}
                            </ul>
                        `;
                    }
                    
                    cronPreview.innerHTML = `
                        <div style="padding: 0.75rem; background: #f0f9ff; border-radius: var(--radius-md); border: 1px solid #0ea5e9;">
                            <div style="font-size: 0.9rem; color: #0369a1;">${previewHtml}</div>
                        </div>
                    `;
                    
                    cronInput.style.borderColor = '#16a34a';
                    
                } else {
                    // È™åËØÅÂ§±Ë¥•
                    cronValidation.innerHTML = `
                        <div style="padding: 0.5rem; background: #fee2e2; border-radius: var(--radius-md); border-left: 4px solid #dc2626;">
                            <small style="color: #dc2626; font-weight: 500;">‚ùå ${response.message || 'È™åËØÅÂ§±Ë¥•'}</small>
                        </div>
                    `;
                    cronPreview.innerHTML = '';
                    cronInput.style.borderColor = '#dc2626';
                }
                
            } catch (error) {
                console.warn('CRONÈ™åËØÅAPIË∞ÉÁî®Â§±Ë¥•:', error);
                // APIË∞ÉÁî®Â§±Ë¥•Êó∂Ôºå‰ΩøÁî®ÂâçÁ´ØÈ™åËØÅÁªìÊûú
                cronValidation.innerHTML = `
                    <div style="padding: 0.5rem; background: #dcfce7; border-radius: var(--radius-md); border-left: 4px solid #16a34a;">
                        <small style="color: #16a34a; font-weight: 500;">‚úÖ Âü∫Êú¨Ê†ºÂºèÈ™åËØÅÈÄöËøá</small>
                    </div>
                `;
                cronPreview.innerHTML = '';
                cronInput.style.borderColor = '#16a34a';
            }
        }







        // Ëé∑Âèñ‰ªªÂä°Á±ªÂûãÊ†áÁ≠æÈ¢úËâ≤
        function getTaskTypeBadgeColor(type) {
            const colors = {
                'batch_analysis': '#1976d2',
                'manual_analysis': '#7b1fa2',
                'manual_extraction': '#f57c00',
                'full_task': '#4caf50',
                'full_task_range': '#2e7d32',
                'cleanup': '#d32f2f'
            };
            return colors[type] || '#616161';
        }

        // Ëé∑Âèñ‰ªªÂä°Á±ªÂûãÊ†áÁ≠æÊñáÊú¨
        function getTaskTypeLabel(type) {
            const labels = {
                'batch_analysis': 'ÂÆöÊó∂ÂàÜÊûê',
                'manual_analysis': 'ÊâãÂä®ÂàÜÊûê',
                'manual_extraction': 'ÊâãÂä®ÊäΩÂèñ',
                'full_task': 'ÂÆåÊï¥ÊµÅÁ®ã',
                'full_task_range': 'Ëá™ÂÆö‰πâËåÉÂõ¥',
                'cleanup': 'Ê∏ÖÁêÜ‰ªªÂä°'
            };
            return labels[type] || type;
        }

        // Ëé∑ÂèñÁä∂ÊÄÅÊ†áÁ≠æÈ¢úËâ≤
        function getStatusBadgeColor(status) {
            const colors = {
                'running': '#1976d2',
                'completed': '#2e7d32',
                'failed': '#c62828',
                'cancelled': '#7b1fa2'
            };
            return colors[status] || '#616161';
        }

        // Ëé∑ÂèñÁä∂ÊÄÅÊ†áÁ≠æÊñáÊú¨
        function getStatusLabel(status) {
            const labels = {
                'running': 'ËøêË°å‰∏≠',
                'completed': 'Â∑≤ÂÆåÊàê',
                'failed': 'Â§±Ë¥•',
                'cancelled': 'Â∑≤ÂèñÊ∂à'
            };
            return labels[status] || status;
        }

        // Ê†ºÂºèÂåñÊó•ÊúüÊó∂Èó¥
        function formatDateTime(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleString('zh-CN', {
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Ê†ºÂºèÂåñË∞ÉÂ∫¶ÊòæÁ§∫
        function formatScheduleDisplay(config) {
            if (!config) return '-';
            
            // ‰ºòÂÖà‰ΩøÁî®ÂêéÁ´ØÂ∑≤Ê†ºÂºèÂåñÁöÑÊòæÁ§∫
            if (config.schedule_display) {
                return config.schedule_display;
            }
            
            // Â¶ÇÊûúÊúâCRONË°®ËææÂºèÔºåÊòæÁ§∫CRON
            if (config.schedule_cron) {
                return `CRON: ${config.schedule_cron}`;
            }
            
            // Ê†πÊçÆÈó¥ÈöîÊó∂Èó¥Ê†ºÂºèÂåñÊòæÁ§∫
            if (config.schedule_interval) {
                const interval = config.schedule_interval;
                if (interval < 60) {
                    return `Èó¥Èöî: ${interval}Áßí`;
                } else if (interval < 3600) {
                    const minutes = Math.floor(interval / 60);
                    return `Èó¥Èöî: ${minutes}ÂàÜÈíü`;
                } else if (interval < 86400) {
                    const hours = Math.floor(interval / 3600);
                    return `Èó¥Èöî: ${hours}Â∞èÊó∂`;
                } else {
                    const days = Math.floor(interval / 86400);
                    return `Èó¥Èöî: ${days}Â§©`;
                }
            }
            
            return '-';
        }

        // Ê†ºÂºèÂåñÊåÅÁª≠Êó∂Èó¥
        function formatDuration(seconds) {
            if (!seconds) return '-';
            
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            if (hours > 0) {
                return `${hours}h${minutes}m`;
            } else if (minutes > 0) {
                return `${minutes}m${secs}s`;
            } else {
                return `${secs}s`;
            }
        }

        // Ê†ºÂºèÂåñÈó¥ÈöîÊó∂Èó¥
        function formatInterval(seconds) {
            if (!seconds) return '-';
            
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            
            if (hours > 0) {
                if (hours >= 24) {
                    const days = Math.floor(hours / 24);
                    const remainingHours = hours % 24;
                    return remainingHours > 0 ? `${days}Â§©${remainingHours}Â∞èÊó∂` : `${days}Â§©`;
                }
                return `${hours}Â∞èÊó∂`;
            } else if (minutes > 0) {
                return `${minutes}ÂàÜÈíü`;
            } else {
                return `${seconds}Áßí`;
            }
        }

        // Ëé∑Âèñ‰ªªÂä°Â§ÑÁêÜÂô®Ê†áÁ≠æÈ¢úËâ≤
        function getTaskHandlerBadgeColor(handler) {
            const colors = {
                'batch_analysis': '#1976d2',
                'cleanup': '#d32f2f',
                'manual_analysis': '#7b1fa2',
                'extraction': '#f57c00'
            };
            return colors[handler] || '#616161';
        }

        // Ëé∑Âèñ‰ªªÂä°Â§ÑÁêÜÂô®Ê†áÁ≠æÊñáÊú¨
        function getTaskHandlerLabel(handler) {
            const labels = {
                'batch_analysis': 'ÊâπÈáèÂàÜÊûê',
                'cleanup': 'Êï∞ÊçÆÊ∏ÖÁêÜ',
                'manual_analysis': 'ÊâãÂä®ÂàÜÊûê',
                'extraction': 'Êï∞ÊçÆÊäΩÂèñ'
            };
            return labels[handler] || handler;
        }

        // Ëá™Âä®ËÆæÁΩÆAPIÂü∫Á°ÄÂú∞ÂùÄ
        function autoSetBaseUrl() {
            const currentHost = window.location.hostname;
            const currentPort = window.location.port;
            const protocol = window.location.protocol;
            
            // Â¶ÇÊûúÂΩìÂâçÈ°µÈù¢ÊúâÁ´ØÂè£Âè∑ÔºåÂàô‰ΩøÁî®ÂΩìÂâçÁ´ØÂè£
            if (currentPort) {
                const autoUrl = `${protocol}//${currentHost}:${currentPort}`;
                document.getElementById('baseUrl').value = autoUrl;
            }
        }

        // ÁÆÄÂçïÁöÑÂÅ•Â∫∑Ê£ÄÊü•
        async function checkSystemHealth() {
            try {
                await apiRequest('/health');
            } catch (error) {
                console.log('Á≥ªÁªüÂÅ•Â∫∑Ê£ÄÊü•Â§±Ë¥•:', error);
            }
        }

        // Ê£ÄÊü•Áî®Êà∑ÁôªÂΩïÁä∂ÊÄÅ
        async function checkAuthStatus() {
            const token = localStorage.getItem('auth_token');
            if (!token) {
                window.location.href = '/static/login.html';
                return false;
            }

            try {
                const response = await fetch('/api/v1/auth/verify', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Token verification failed');
                }

                const result = await response.json();
                if (!result.success) {
                    throw new Error('Invalid token');
                }

                // ÊòæÁ§∫Áî®Êà∑‰ø°ÊÅØ
                const username = localStorage.getItem('username') || result.username;
                const userInfo = document.createElement('div');
                userInfo.innerHTML = `
                    <div style="position: fixed; top: 10px; right: 10px; background: var(--bg-primary); padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border-color); font-size: 0.9rem; z-index: 1000;">
                        <span style="color: var(--text-secondary);">Ê¨¢ËøéÔºå</span>
                        <strong style="color: var(--text-primary);">${username}</strong>
                        <button onclick="logout()" style="margin-left: 0.5rem; padding: 0.25rem 0.5rem; font-size: 0.8rem; background: var(--error-color); color: white; border: none; border-radius: 4px; cursor: pointer;">
                            ÁôªÂá∫
                        </button>
                    </div>
                `;
                document.body.appendChild(userInfo);

                return true;
            } catch (error) {
                console.error('Auth check failed:', error);
                localStorage.removeItem('auth_token');
                localStorage.removeItem('username');
                window.location.href = '/static/login.html';
                return false;
            }
        }

        // ÁôªÂá∫ÂäüËÉΩ
        async function logout() {
            const confirmed = confirm('Á°ÆËÆ§ÁôªÂá∫ÂêóÔºü');
            if (!confirmed) return;

            try {
                await fetch('/api/v1/auth/logout', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('auth_token')}`
                    }
                });
            } catch (error) {
                console.log('Logout request failed, but continuing...');
            }

            localStorage.removeItem('auth_token');
            localStorage.removeItem('username');
            window.location.href = '/static/login.html';
        }

        // üî• Êñ∞Â¢ûÔºö‰ªªÂä°Áä∂ÊÄÅËΩÆËØ¢Áõ∏ÂÖ≥ÂáΩÊï∞
        
        /**
         * ÂêØÂä®‰ªªÂä°Áä∂ÊÄÅËΩÆËØ¢
         * @param {string} taskId - ‰ªªÂä°ID
         * @param {string} taskKey - ‰ªªÂä°ÈîÆÂêç
         */
        async function startTaskPolling(taskId, taskKey) {
            console.log(`üîÑ ÂºÄÂßãËΩÆËØ¢‰ªªÂä°Áä∂ÊÄÅ: ${taskId}`);
            
            // Ê∏ÖÈô§‰πãÂâçÁöÑËΩÆËØ¢
            if (pollingIntervals.has(taskId)) {
                clearInterval(pollingIntervals.get(taskId));
            }
            
            isPollingActive = true;
            updatePollingStatusDisplay();
            
            // Á´ãÂç≥ÊâßË°å‰∏ÄÊ¨°Áä∂ÊÄÅÊ£ÄÊü•
            await checkTaskStatus(taskId, taskKey);
            
            // ËÆæÁΩÆÂÆöÊó∂ËΩÆËØ¢ÔºàÊØè5ÁßíÊ£ÄÊü•‰∏ÄÊ¨°ÔºåÈÅøÂÖçËß¶ÂèëÈôêÊµÅÔºâ
            const intervalId = setInterval(async () => {
                try {
                    await checkTaskStatus(taskId, taskKey);
                } catch (error) {
                    console.error(`ËΩÆËØ¢‰ªªÂä°Áä∂ÊÄÅÂ§±Ë¥•: ${taskId}`, error);
                    stopTaskPolling(taskId);
                }
            }, 5000);
            
            pollingIntervals.set(taskId, intervalId);
        }
        
        /**
         * Ê£ÄÊü•Âçï‰∏™‰ªªÂä°Áä∂ÊÄÅ
         * @param {string} taskId - ‰ªªÂä°ID
         * @param {string} taskKey - ‰ªªÂä°ÈîÆÂêç
         */
        async function checkTaskStatus(taskId, taskKey) {
            try {
                const result = await apiRequest(`/api/v1/tasks/records/${taskId}`, 'GET');
                
                if (result && result.success && result.data) {
                    const taskData = result.data;
                    const status = taskData.status;
                    const completionRate = taskData.completion_rate || 0;
                    const processStage = taskData.process_stage || 'Êú™Áü•Èò∂ÊÆµ';
                    
                    // Êõ¥Êñ∞ËøõÂ∫¶ÊòæÁ§∫
                    updateTaskProgressDisplay(taskId, taskKey, taskData);
                    
                    // Ê£ÄÊü•‰ªªÂä°ÊòØÂê¶ÂÆåÊàê
                    if (status === 'completed') {
                        stopTaskPolling(taskId);
                        showTaskCompletionResult(taskId, taskKey, taskData);
                    } else if (status === 'failed' || status === 'cancelled') {
                        stopTaskPolling(taskId);
                        showTaskFailureResult(taskId, taskKey, taskData);
                    }
                    
                    // Âà∑Êñ∞‰ªªÂä°ÂàóË°®
                    refreshTaskConfigs();
                } else {
                    console.warn(`Êó†Ê≥ïËé∑Âèñ‰ªªÂä°Áä∂ÊÄÅ: ${taskId}`);
                }
            } catch (error) {
                console.error(`Ê£ÄÊü•‰ªªÂä°Áä∂ÊÄÅÂ§±Ë¥•: ${taskId}`, error);
                throw error;
            }
        }
        
        /**
         * ÂÅúÊ≠¢‰ªªÂä°ËΩÆËØ¢
         * @param {string} taskId - ‰ªªÂä°ID
         */
        function stopTaskPolling(taskId) {
            if (pollingIntervals.has(taskId)) {
                clearInterval(pollingIntervals.get(taskId));
                pollingIntervals.delete(taskId);
                console.log(`‚èπÔ∏è ÂÅúÊ≠¢ËΩÆËØ¢‰ªªÂä°Áä∂ÊÄÅ: ${taskId}`);
            }
            
            // Ê£ÄÊü•ÊòØÂê¶ËøòÊúâÂÖ∂‰ªñËΩÆËØ¢Âú®ËøêË°å
            if (pollingIntervals.size === 0) {
                isPollingActive = false;
                updatePollingStatusDisplay();
            }
        }
        
        /**
         * ÂÅúÊ≠¢ÊâÄÊúâËΩÆËØ¢
         */
        function stopAllPolling() {
            pollingIntervals.forEach((intervalId, taskId) => {
                clearInterval(intervalId);
                console.log(`‚èπÔ∏è ÂÅúÊ≠¢ËΩÆËØ¢‰ªªÂä°Áä∂ÊÄÅ: ${taskId}`);
            });
            pollingIntervals.clear();
            isPollingActive = false;
            updatePollingStatusDisplay();
        }
        
        /**
         * Êõ¥Êñ∞ËΩÆËØ¢Áä∂ÊÄÅÊòæÁ§∫
         */
        function updatePollingStatusDisplay() {
            const statusElement = document.getElementById('pollingStatus');
            if (statusElement) {
                if (isPollingActive && pollingIntervals.size > 0) {
                    statusElement.style.display = 'block';
                    const countText = pollingIntervals.size > 1 ? `(${pollingIntervals.size}‰∏™‰ªªÂä°)` : '';
                    const textSpan = statusElement.querySelector('span:nth-child(2)');
                    if (textSpan) {
                        textSpan.textContent = `Ê≠£Âú®ÁõëÊéß‰ªªÂä°ËøõÂ∫¶... ${countText}`;
                    }
                } else {
                    statusElement.style.display = 'none';
                }
            }
        }
        
        /**
         * Êõ¥Êñ∞‰ªªÂä°ËøõÂ∫¶ÊòæÁ§∫
         * @param {string} taskId - ‰ªªÂä°ID
         * @param {string} taskKey - ‰ªªÂä°ÈîÆÂêç
         * @param {object} taskData - ‰ªªÂä°Êï∞ÊçÆ
         */
        function updateTaskProgressDisplay(taskId, taskKey, taskData) {
            const successRecords = taskData.success_records || 0;
            const failedRecords = taskData.failed_records || 0;
            const skippedRecords = taskData.skipped_records || 0;
            const totalRecords = taskData.total_records || 0;
            
            // üî• ‰øÆÂ§çËøõÂ∫¶ËÆ°ÁÆóÈÄªËæëÔºöÂÆåÂÖ®‰ΩøÁî®ÂêéÁ´ØËÆ°ÁÆóÁöÑcompletion_rateÔºå‰∏çÂú®ÂâçÁ´ØÈáçÊñ∞ËÆ°ÁÆó
            // ÂêéÁ´ØÂ∑≤ÁªèÊ≠£Á°ÆÂ§ÑÁêÜ‰∫ÜÂêÑÁßçËæπÁïåÊÉÖÂÜµÔºàÊÄªÊï∞‰∏∫0„ÄÅÊäΩÂèñÈò∂ÊÆµË∑≥ËøáÁ≠âÔºâ
            const completionRate = taskData.completion_rate || 0;
            
            const processStage = taskData.process_stage || 'Â§ÑÁêÜ‰∏≠';
            
            // ËÆ°ÁÆóÂΩìÂâçËÄóÊó∂
            let currentDuration = '';
            if (taskData.start_time) {
                const startTime = new Date(taskData.start_time);
                const now = new Date();
                const durationSeconds = Math.floor((now - startTime) / 1000);
                currentDuration = `\n‚è±Ô∏è ÂΩìÂâçËÄóÊó∂: ${formatDuration(durationSeconds)}`;
            }
            
            // ÊûÑÂª∫ËøõÂ∫¶‰ø°ÊÅØ
            let progressInfo = `üìä ‰ªªÂä°ËøõÂ∫¶Êõ¥Êñ∞ (${taskId.substring(0, 16)}...)\n`;
            progressInfo += `üîÑ ÂΩìÂâçÈò∂ÊÆµ: ${processStage}\n`;
            progressInfo += `üìà ÂÆåÊàêËøõÂ∫¶: ${completionRate.toFixed(1)}%`;
            progressInfo += currentDuration;
            
            if (totalRecords > 0) {
                progressInfo += `\nüìã Â§ÑÁêÜÁªüËÆ°:\n`;
                progressInfo += `  ‚úÖ ÊàêÂäü: ${successRecords} Êù°\n`;
                progressInfo += `  ‚ùå Â§±Ë¥•: ${failedRecords} Êù°\n`;
                if (skippedRecords > 0) {
                    progressInfo += `  ‚è≠Ô∏è Ë∑≥Ëøá: ${skippedRecords} Êù°\n`;
                }
                progressInfo += `  üìä ÊÄªËÆ°: ${totalRecords} Êù°`;
                
                // üî• Êñ∞Â¢ûÔºöÊòæÁ§∫ÈáçÂ§çÊï∞ÊçÆÁªüËÆ°
                const duplicateRecords = taskData.duplicate_records || 0;
                const extractedRecords = taskData.extracted_records || 0;
                if (duplicateRecords > 0 && extractedRecords > 0) {
                    const duplicateRate = (duplicateRecords / extractedRecords * 100).toFixed(1);
                    progressInfo += `\nüîÑ Êï∞ÊçÆÊäΩÂèñÁªüËÆ°:\n`;
                    progressInfo += `  üì• ÊäΩÂèñÊÄªÈáè: ${extractedRecords} Êù°\n`;
                    progressInfo += `  üÜï Êñ∞Â¢ûÊï∞ÊçÆ: ${totalRecords} Êù°\n`;
                    progressInfo += `  üîÅ ÈáçÂ§çËøáÊª§: ${duplicateRecords} Êù° (${duplicateRate}%)`;
                }
            }
            
            // Âú®ÁªìÊûúÂå∫ÂüüÊòæÁ§∫ËøõÂ∫¶
            showResult(progressInfo, 'info');
        }
        
        /**
         * ÊòæÁ§∫‰ªªÂä°ÂÆåÊàêÁªìÊûú
         * @param {string} taskId - ‰ªªÂä°ID
         * @param {string} taskKey - ‰ªªÂä°ÈîÆÂêç
         * @param {object} taskData - ‰ªªÂä°Êï∞ÊçÆ
         */
        function showTaskCompletionResult(taskId, taskKey, taskData) {
            const successRecords = taskData.success_records || 0;
            const failedRecords = taskData.failed_records || 0;
            const skippedRecords = taskData.skipped_records || 0;
            const totalRecords = taskData.total_records || 0;
            const durationSeconds = taskData.duration_seconds || 0;
            const durationText = durationSeconds > 0 ? `\n‚è±Ô∏è ÊâßË°åÊó∂Èïø: ${Math.round(durationSeconds)}Áßí` : '';
            
            let completionMessage = `üéâ ‰ªªÂä°ÊâßË°åÂÆåÊàêÔºÅ\n`;
            completionMessage += `üìã ‰ªªÂä°ID: ${taskId}\n`;
            completionMessage += `üìä ÊúÄÁªàÁªüËÆ°:\n`;
            completionMessage += `  ‚úÖ ÊàêÂäü: ${successRecords} Êù°\n`;
            completionMessage += `  ‚ùå Â§±Ë¥•: ${failedRecords} Êù°\n`;
            if (skippedRecords > 0) {
                completionMessage += `  ‚è≠Ô∏è Ë∑≥Ëøá: ${skippedRecords} Êù°\n`;
            }
            completionMessage += `  üìä ÊÄªËÆ°: ${totalRecords} Êù°`;
            completionMessage += durationText;
            
            showResult(completionMessage, 'success');
        }
        
        /**
         * ÊòæÁ§∫‰ªªÂä°Â§±Ë¥•ÁªìÊûú
         * @param {string} taskId - ‰ªªÂä°ID
         * @param {string} taskKey - ‰ªªÂä°ÈîÆÂêç
         * @param {object} taskData - ‰ªªÂä°Êï∞ÊçÆ
         */
        function showTaskFailureResult(taskId, taskKey, taskData) {
            const status = taskData.status;
            const errorMessage = taskData.error_message || 'Êú™Áü•ÈîôËØØ';
            const durationSeconds = taskData.duration_seconds || 0;
            const durationText = durationSeconds > 0 ? `\n‚è±Ô∏è ÊâßË°åÊó∂Èïø: ${Math.round(durationSeconds)}Áßí` : '';
            
            let failureMessage = `‚ùå ‰ªªÂä°ÊâßË°å${status === 'cancelled' ? 'Â∑≤ÂèñÊ∂à' : 'Â§±Ë¥•'}ÔºÅ\n`;
            failureMessage += `üìã ‰ªªÂä°ID: ${taskId}\n`;
            failureMessage += `üìù ÈîôËØØ‰ø°ÊÅØ: ${errorMessage}`;
            failureMessage += durationText;
            
            showResult(failureMessage, 'error');
        }
        
        /**
         * Ê£ÄÊü•Ê≠£Âú®ËøêË°åÁöÑ‰ªªÂä°Ôºà‰ªÖÁî®‰∫éÊòæÁ§∫Áä∂ÊÄÅÔºå‰∏çËá™Âä®ÂºÄÂêØËΩÆËØ¢Ôºâ
         */
        async function checkForRunningTasks() {
            try {
                console.log('üîç Ê£ÄÊü•Ê≠£Âú®ËøêË°åÁöÑ‰ªªÂä°...');
                const result = await apiRequest('/api/v1/tasks/records?status=running&limit=10', 'GET');
                
                if (result && result.success && result.data && result.data.length > 0) {
                    console.log(`üìã ÂèëÁé∞ ${result.data.length} ‰∏™Ê≠£Âú®ËøêË°åÁöÑ‰ªªÂä°`);
                    // Âè™ÊòæÁ§∫Áä∂ÊÄÅÔºå‰∏çËá™Âä®ÂºÄÂêØËΩÆËØ¢ - Áî®Êà∑ÈúÄË¶ÅÊâãÂä®ÁÇπÂáªÊü•ÁúãËÆ∞ÂΩïÊù•ÁõëÊéß
                } else {
                    console.log('üìã Ê≤°ÊúâÂèëÁé∞Ê≠£Âú®ËøêË°åÁöÑ‰ªªÂä°');
                }
            } catch (error) {
                console.error('Ê£ÄÊü•ËøêË°å‰∏≠‰ªªÂä°Â§±Ë¥•:', error);
            }
        }

        // È°µÈù¢Âç∏ËΩΩÊó∂ÂÅúÊ≠¢ÊâÄÊúâËΩÆËØ¢
        window.addEventListener('beforeunload', function() {
            stopAllPolling();
        });

        
        window.addEventListener('load', async function() {
            // È¶ñÂÖàÊ£ÄÊü•ËÆ§ËØÅÁä∂ÊÄÅ
            const isAuthenticated = await checkAuthStatus();
            if (!isAuthenticated) return;

            autoSetBaseUrl();
            checkSystemHealth();
            // üî• Êñ∞Â¢ûÔºöÂä†ËΩΩÊÄªÂºÄÂÖ≥Áä∂ÊÄÅ
            loadMasterSwitchStatus();
            // Ëá™Âä®Âä†ËΩΩ‰ªªÂä°ÈÖçÁΩÆÂíåÁ≥ªÁªüÁõëÊéß
            setTimeout(() => {
                refreshTaskConfigs();
                refreshSystemMonitor();
                // Ê£ÄÊü•Ê≠£Âú®ËøêË°åÁöÑ‰ªªÂä°Áä∂ÊÄÅÔºà‰∏çËá™Âä®ÂºÄÂêØËΩÆËØ¢Ôºâ
                checkForRunningTasks();
            }, 1000);
        });
    </script>
</body>
</html>
